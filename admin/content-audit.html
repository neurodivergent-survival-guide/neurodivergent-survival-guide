---
layout: default
title: "Content Audit Dashboard"
permalink: /content-audit/
---

<style>
.audit-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
}

.audit-header {
    text-align: center;
    margin-bottom: 2rem;
}

.audit-controls {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
}

.control-row {
    display: flex;
    gap: 1rem;
    justify-content: center;
    align-items: center;
    margin-bottom: 1rem;
    flex-wrap: wrap;
}

.analyze-btn, .copy-btn {
    border: none;
    padding: 1rem 2rem;
    border-radius: 6px;
    font-size: 1.1rem;
    cursor: pointer;
    font-weight: 500;
}

.analyze-btn {
    background: #007acc;
    color: white;
}

.analyze-btn:hover {
    background: #005999;
}

.copy-btn {
    background: #28a745;
    color: white;
}

.copy-btn:hover {
    background: #1e7e34;
}

.copy-btn:disabled {
    background: #6c757d;
    cursor: not-allowed;
}

.search-box {
    padding: 0.8rem 1rem;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 1rem;
    width: 300px;
}

.search-box:focus {
    outline: none;
    border-color: #007acc;
}

.filter-controls {
    display: flex;
    gap: 1.5rem;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 1rem;
}

.filter-controls label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.9rem;
}

.loading {
    text-align: center;
    padding: 2rem;
    display: none;
    font-size: 1.1rem;
}

.copy-feedback {
    display: none;
    color: #28a745;
    font-weight: 500;
    margin-top: 0.5rem;
    text-align: center;
}

.results-table {
    background: white;
    border-radius: 8px;
    overflow-x: auto;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    display: none;
}

table {
    width: 100%;
    border-collapse: collapse;
    min-width: 1200px;
}

th, td {
    padding: 0.8rem 0.6rem;
    text-align: left;
    border-bottom: 1px solid #eee;
    font-size: 0.85rem;
}

th {
    background: #f8f9fa;
    font-weight: 600;
    position: sticky;
    top: 0;
    white-space: nowrap;
}

.article-title {
    max-width: 200px;
    font-weight: 500;
}

.article-title a {
    text-decoration: none;
    color: #007acc;
}

.article-title a:hover {
    text-decoration: underline;
}

.word-count {
    text-align: center;
    font-weight: 500;
    padding: 0.3rem 0.6rem;
    border-radius: 4px;
    white-space: nowrap;
}

.count-low { 
    background: #ffebee; 
    color: #c62828; 
    font-weight: 600;
}

.count-target { 
    background: #e8f5e8; 
    color: #2e7d32; 
}

.count-high { 
    background: #fff3e0; 
    color: #f57c00; 
}

.condition-badge {
    padding: 0.3rem 0.8rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
}

.condition-adhd { background: #ffebee; color: #d63031; }
.condition-autism { background: #d4edda; color: #27ae60; }
.condition-bipolar { background: #e3f2fd; color: #74b9ff; }
.condition-bpd { background: #fef9e7; color: #f39c12; }
.condition-ocd { background: #f3e5f5; color: #9c27b0; }

.summary-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
    display: none;
}

.stat-card {
    background: white;
    padding: 1.2rem;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.stat-number {
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 0.3rem;
}

.stat-number.low { color: #c62828; }
.stat-number.target { color: #2e7d32; }
.stat-number.high { color: #f57c00; }

.hidden-row {
    display: none !important;
}

@media (max-width: 768px) {
    .control-row {
        flex-direction: column;
        gap: 1rem;
    }
    
    .search-box {
        width: 100%;
        max-width: 300px;
    }
    
    .filter-controls {
        flex-direction: column;
        gap: 0.8rem;
    }
    
    table {
        font-size: 0.8rem;
    }
    
    th, td {
        padding: 0.6rem 0.4rem;
    }
}
</style>

<div class="audit-container">
    <div class="audit-header">
        <h1>Content Audit Dashboard</h1>
        <p>Automated word count analysis for all struggle articles</p>
    </div>

    <div class="audit-controls">
        <div class="control-row">
            <button class="analyze-btn" onclick="analyzeAllArticles()">Analyze All Articles</button>
            <button class="copy-btn" id="copy-btn" onclick="copyResultsToClipboard()" disabled>Copy Results to Clipboard</button>
        </div>
        
        <div class="control-row">
            <input type="text" class="search-box" id="search-box" placeholder="Search articles by title..." oninput="filterResults()">
        </div>
        
        <div class="filter-controls">
            <label><input type="radio" name="filter" value="all" checked onchange="filterResults()"> All Articles</label>
            <label><input type="radio" name="filter" value="under" onchange="filterResults()"> Under Target (&lt;2150)</label>
            <label><input type="radio" name="filter" value="target" onchange="filterResults()"> On Target (2150-2550)</label>
            <label><input type="radio" name="filter" value="over" onchange="filterResults()"> Over Target (&gt;2550)</label>
        </div>
        
        <div class="loading" id="loading">
            <p>Analyzing articles... <span id="progress">0</span> of <span id="total">0</span> complete</p>
        </div>
        
        <div class="copy-feedback" id="copy-feedback">
            ✓ Results copied to clipboard!
        </div>
    </div>

    <div class="summary-stats" id="summary-stats">
        <div class="stat-card">
            <div class="stat-number" id="total-count">0</div>
            <div>Total Articles</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="avg-words">0</div>
            <div>Average Words</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="on-target">0</div>
            <div>On Target</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="under-target">0</div>
            <div>Under Target</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="over-target">0</div>
            <div>Over Target</div>
        </div>
    </div>

    <div class="results-table" id="results-table">
        <table>
            <thead>
                <tr>
                    <th>Article</th>
                    <th>Condition</th>
                    <th>Total</th>
                    <th>What (300-400)</th>
                    <th>Why (~400)</th>
                    <th>Next 5 (300-500)</th>
                    <th>Long-term (~550)</th>
                    <th>Medical (200-300)</th>
                    <th>Validation (~400)</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="results-body">
                <!-- Results populated by JavaScript -->
            </tbody>
        </table>
    </div>
</div>

<!-- Article URLs for analysis -->
<div style="display: none;" id="article-data">
{% for page in site.pages %}
  {% if page.layout == 'struggle' %}
  <div data-title="{{ page.title }}" 
       data-url="{{ page.url }}" 
       data-condition="{{ page.condition }}"
       data-status="{{ page.status | default: 'published' }}"></div>
  {% endif %}
{% endfor %}
</div>

<script>
let allResults = [];

async function analyzeAllArticles() {
    const button = document.querySelector('.analyze-btn');
    const loading = document.getElementById('loading');
    const resultsTable = document.getElementById('results-table');
    const summaryStats = document.getElementById('summary-stats');
    const copyBtn = document.getElementById('copy-btn');
    
    button.disabled = true;
    button.textContent = 'Analyzing...';
    loading.style.display = 'block';
    copyBtn.disabled = true;
    
    // Get article list from Jekyll data
    const articleElements = document.querySelectorAll('#article-data div[data-title]');
    const articles = Array.from(articleElements).map(el => ({
        title: el.dataset.title,
        url: el.dataset.url,
        condition: el.dataset.condition,
        status: el.dataset.status
    }));
    
    document.getElementById('total').textContent = articles.length;
    
    allResults = [];
    
    for (let i = 0; i < articles.length; i++) {
        const article = articles[i];
        document.getElementById('progress').textContent = i + 1;
        
        try {
            // Fetch the article content
            const response = await fetch(article.url);
            const html = await response.text();
            
            // Parse HTML and extract sections
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            console.log(`Analyzing: ${article.title}`);
            
            // Count words in each section
            const sections = {
                what: countSectionWords(doc, '.what-section'),
                why: countSectionWords(doc, '.why-section'),
                nextFive: countSectionWords(doc, '.immediate-help'),
                longTerm: countSectionWords(doc, '.long-term'),
                medical: countSectionWords(doc, '.medical-section'),
                validation: countSectionWords(doc, '.validation-section')
            };
            
            const totalWords = Object.values(sections).reduce((a, b) => a + b, 0);
            const onTarget = totalWords >= 2150 && totalWords <= 2550;
            
            allResults.push({
                ...article,
                sections,
                totalWords,
                onTarget
            });
            
        } catch (error) {
            console.error(`Error analyzing ${article.title}:`, error);
            allResults.push({
                ...article,
                sections: { what: 0, why: 0, nextFive: 0, longTerm: 0, medical: 0, validation: 0 },
                totalWords: 0,
                onTarget: false,
                error: true
            });
        }
    }
    
    // Sort by total word count (lowest first to highlight issues)
    allResults.sort((a, b) => a.totalWords - b.totalWords);
    
    // Render results
    renderResults(allResults);
    updateSummaryStats(allResults);
    
    // Show results and hide loading
    loading.style.display = 'none';
    resultsTable.style.display = 'block';
    summaryStats.style.display = 'grid';
    button.disabled = false;
    button.textContent = 'Re-analyze All Articles';
    copyBtn.disabled = false;
}

function filterResults() {
    const searchTerm = document.getElementById('search-box').value.toLowerCase();
    const filterType = document.querySelector('input[name="filter"]:checked').value;
    
    const filteredResults = allResults.filter(article => {
        // Search filter
        const matchesSearch = article.title.toLowerCase().includes(searchTerm);
        
        // Status filter
        let matchesFilter = true;
        if (filterType === 'under') {
            matchesFilter = article.totalWords < 2150;
        } else if (filterType === 'target') {
            matchesFilter = article.totalWords >= 2150 && article.totalWords <= 2550;
        } else if (filterType === 'over') {
            matchesFilter = article.totalWords > 2550;
        }
        
        return matchesSearch && matchesFilter;
    });
    
    renderResults(filteredResults);
    updateSummaryStats(filteredResults);
}

async function analyzeSingleArticle() {
    const select = document.getElementById('article-select');
    const selectedOption = select.options[select.selectedIndex];
    
    if (!selectedOption.value) {
        alert('Please select an article to analyze');
        return;
    }
    
    const article = {
        title: selectedOption.dataset.title,
        url: selectedOption.value,
        condition: selectedOption.dataset.condition
    };
    
    try {
        // Fetch the article content
        const response = await fetch(article.url);
        const html = await response.text();
        
        // Parse HTML and extract sections
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        
        console.log(`Analyzing single article: ${article.title}`);
        
        // Count words in each section
        const sections = {
            what: countSectionWords(doc, '.what-section'),
            why: countSectionWords(doc, '.why-section'),
            nextFive: countSectionWords(doc, '.immediate-help'),
            longTerm: countSectionWords(doc, '.long-term'),
            medical: countSectionWords(doc, '.medical-section'),
            validation: countSectionWords(doc, '.validation-section')
        };
        
        const totalWords = Object.values(sections).reduce((a, b) => a + b, 0);
        const onTarget = totalWords >= 2150 && totalWords <= 2550;
        
        // Format single article results for clipboard
        let clipboardText = `SINGLE ARTICLE ANALYSIS: ${article.title}\n`;
        clipboardText += `Condition: ${article.condition.toUpperCase()}\n`;
        clipboardText += `Total Words: ${totalWords} ${onTarget ? '✓ ON TARGET' : totalWords < 2150 ? '✗ UNDER TARGET' : '⚠ OVER TARGET'}\n\n`;
        
        clipboardText += `SECTION BREAKDOWN:\n`;
        clipboardText += `What This Feels Like: ${sections.what} words ${sections.what >= 300 && sections.what <= 400 ? '✓' : sections.what < 300 ? '(need +' + (300 - sections.what) + ')' : '(over by ' + (sections.what - 400) + ')'}\n`;
        clipboardText += `Why This Happens: ${sections.why} words ${sections.why >= 380 && sections.why <= 420 ? '✓' : sections.why < 380 ? '(need +' + (380 - sections.why) + ')' : '(over by ' + (sections.why - 420) + ')'}\n`;
        clipboardText += `Next 5 Minutes: ${sections.nextFive} words ${sections.nextFive >= 300 && sections.nextFive <= 500 ? '✓' : sections.nextFive < 300 ? '(need +' + (300 - sections.nextFive) + ')' : '(over by ' + (sections.nextFive - 500) + ')'}\n`;
        clipboardText += `Long-term Solutions: ${sections.longTerm} words ${sections.longTerm >= 500 && sections.longTerm <= 600 ? '✓' : sections.longTerm < 500 ? '(need +' + (500 - sections.longTerm) + ')' : '(over by ' + (sections.longTerm - 600) + ')'}\n`;
        clipboardText += `Medical Intervention: ${sections.medical} words ${sections.medical >= 200 && sections.medical <= 300 ? '✓' : sections.medical < 200 ? '(need +' + (200 - sections.medical) + ')' : '(over by ' + (sections.medical - 300) + ')'}\n`;
        clipboardText += `Validation: ${sections.validation} words ${sections.validation >= 350 && sections.validation <= 450 ? '✓' : sections.validation < 350 ? '(need +' + (350 - sections.validation) + ')' : '(over by ' + (sections.validation - 450) + ')'}\n\n`;
        
        clipboardText += `TARGET RANGES:\n`;
        clipboardText += `What This Feels Like: 300-400 words\n`;
        clipboardText += `Why This Happens: ~400 words\n`;
        clipboardText += `Next 5 Minutes: 300-500 words\n`;
        clipboardText += `Long-term Solutions: ~550 words\n`;
        clipboardText += `Medical Intervention: 200-300 words\n`;
        clipboardText += `Validation: ~400 words\n`;
        
        // Copy to clipboard
        await navigator.clipboard.writeText(clipboardText);
        
        // Show feedback
        const feedback = document.getElementById('copy-feedback');
        feedback.textContent = `✓ ${article.title} analysis copied to clipboard!`;
        feedback.style.display = 'block';
        setTimeout(() => {
            feedback.style.display = 'none';
            feedback.textContent = '✓ Results copied to clipboard!';
        }, 3000);
        
    } catch (error) {
        console.error(`Error analyzing ${article.title}:`, error);
        alert(`Error analyzing article: ${error.message}`);
    }
}
    const copyBtn = document.getElementById('copy-btn');
    const feedback = document.getElementById('copy-feedback');
    
    // Get current filtered results
    const searchTerm = document.getElementById('search-box').value.toLowerCase();
    const filterType = document.querySelector('input[name="filter"]:checked').value;
    
    const filteredResults = allResults.filter(article => {
        const matchesSearch = article.title.toLowerCase().includes(searchTerm);
        let matchesFilter = true;
        if (filterType === 'under') {
            matchesFilter = article.totalWords < 2150;
        } else if (filterType === 'target') {
            matchesFilter = article.totalWords >= 2150 && article.totalWords <= 2550;
        } else if (filterType === 'over') {
            matchesFilter = article.totalWords > 2550;
        }
        return matchesSearch && matchesFilter;
    });
    
    // Format results for clipboard
    let clipboardText = `CONTENT AUDIT RESULTS (${filteredResults.length} articles)\n`;
    clipboardText += `Filter: ${filterType === 'all' ? 'All Articles' : filterType} ${searchTerm ? `| Search: "${searchTerm}"` : ''}\n\n`;
    
    // Add summary stats
    const totalArticles = filteredResults.length;
    const avgWords = Math.round(filteredResults.reduce((sum, a) => sum + a.totalWords, 0) / totalArticles);
    const onTarget = filteredResults.filter(a => a.onTarget).length;
    const underTarget = filteredResults.filter(a => a.totalWords < 2150).length;
    const overTarget = filteredResults.filter(a => a.totalWords > 2550).length;
    
    clipboardText += `SUMMARY:\n`;
    clipboardText += `Total: ${totalArticles} | Average: ${avgWords} words | On Target: ${onTarget} | Under: ${underTarget} | Over: ${overTarget}\n\n`;
    
    clipboardText += `DETAILED BREAKDOWN:\n`;
    clipboardText += `Article | Total | What | Why | Next5 | Long | Medical | Valid | Status\n`;
    clipboardText += `${'='.repeat(80)}\n`;
    
    filteredResults.forEach(article => {
        const status = article.totalWords < 2150 ? 'LOW' : article.totalWords > 2550 ? 'HIGH' : 'OK';
        clipboardText += `${article.title.substring(0, 25).padEnd(25)} | ${article.totalWords.toString().padStart(5)} | ${article.sections.what.toString().padStart(4)} | ${article.sections.why.toString().padStart(3)} | ${article.sections.nextFive.toString().padStart(5)} | ${article.sections.longTerm.toString().padStart(4)} | ${article.sections.medical.toString().padStart(7)} | ${article.sections.validation.toString().padStart(5)} | ${status}\n`;
    });
    
    clipboardText += `\nTARGET RANGES:\n`;
    clipboardText += `What This Feels Like: 300-400 words\n`;
    clipboardText += `Why This Happens: ~400 words\n`;
    clipboardText += `Next 5 Minutes: 300-500 words\n`;
    clipboardText += `Long-term Solutions: ~550 words\n`;
    clipboardText += `Medical Intervention: 200-300 words\n`;
    clipboardText += `Validation: ~400 words\n`;
    
    try {
        await navigator.clipboard.writeText(clipboardText);
        feedback.style.display = 'block';
        setTimeout(() => {
            feedback.style.display = 'none';
        }, 3000);
    } catch (err) {
        console.error('Failed to copy to clipboard:', err);
        // Fallback - create a text area and select it
        const textarea = document.createElement('textarea');
        textarea.value = clipboardText;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        
        feedback.textContent = '✓ Results copied to clipboard! (fallback method)';
        feedback.style.display = 'block';
        setTimeout(() => {
            feedback.style.display = 'none';
            feedback.textContent = '✓ Results copied to clipboard!';
        }, 3000);
    }
}

function countSectionWords(doc, selector) {
    const section = doc.querySelector(selector);
    if (!section) {
        console.log(`Section not found: ${selector}`);
        return 0;
    }
    
    // Remove tooltip content from word count
    const clone = section.cloneNode(true);
    const tooltips = clone.querySelectorAll('.tooltip');
    tooltips.forEach(tooltip => tooltip.remove());
    
    // Also remove any Jekyll/Liquid comments or other non-content
    const comments = clone.querySelectorAll('<!-- -->');
    comments.forEach(comment => comment.remove());
    
    // Get text content and count words
    const text = clone.textContent || clone.innerText || '';
    const words = text.trim().split(/\s+/).filter(word => word.length > 0);
    
    console.log(`${selector}: ${words.length} words`);
    return words.length;
}

function renderResults(results) {
    const tbody = document.getElementById('results-body');
    tbody.innerHTML = '';
    
    results.forEach(article => {
        const row = document.createElement('tr');
        row.className = 'article-row';
        row.dataset.title = article.title.toLowerCase();
        
        const statusClass = article.totalWords < 2150 ? 'under' : 
                           article.totalWords > 2550 ? 'over' : 'target';
        
        row.innerHTML = `
            <td class="article-title">
                <a href="${article.url}" target="_blank">${article.title}</a>
            </td>
            <td>
                <span class="condition-badge condition-${article.condition}">
                    ${article.condition}
                </span>
            </td>
            <td>
                <span class="word-count ${getCountClass(article.totalWords, 2150, 2550)}">
                    ${article.totalWords}
                </span>
            </td>
            <td>
                <span class="word-count ${getCountClass(article.sections.what, 300, 400)}">
                    ${article.sections.what}
                </span>
            </td>
            <td>
                <span class="word-count ${getCountClass(article.sections.why, 380, 420)}">
                    ${article.sections.why}
                </span>
            </td>
            <td>
                <span class="word-count ${getCountClass(article.sections.nextFive, 300, 500)}">
                    ${article.sections.nextFive}
                </span>
            </td>
            <td>
                <span class="word-count ${getCountClass(article.sections.longTerm, 500, 600)}">
                    ${article.sections.longTerm}
                </span>
            </td>
            <td>
                <span class="word-count ${getCountClass(article.sections.medical, 200, 300)}">
                    ${article.sections.medical}
                </span>
            </td>
            <td>
                <span class="word-count ${getCountClass(article.sections.validation, 350, 450)}">
                    ${article.sections.validation}
                </span>
            </td>
            <td>
                <span class="word-count ${statusClass === 'target' ? 'count-target' : statusClass === 'over' ? 'count-high' : 'count-low'}">
                    ${statusClass === 'target' ? '✓' : statusClass === 'over' ? '⚠' : '✗'}
                </span>
            </td>
        `;
        
        tbody.appendChild(row);
    });
}

function updateSummaryStats(results) {
    document.getElementById('total-count').textContent = results.length;
    
    const avgWords = results.length > 0 ? Math.round(
        results.reduce((sum, a) => sum + a.totalWords, 0) / results.length
    ) : 0;
    document.getElementById('avg-words').textContent = avgWords;
    
    const onTarget = results.filter(a => a.onTarget).length;
    const underTarget = results.filter(a => a.totalWords < 2150).length;
    const overTarget = results.filter(a => a.totalWords > 2550).length;
    
    document.getElementById('on-target').textContent = onTarget;
    document.getElementById('under-target').textContent = underTarget;
    document.getElementById('over-target').textContent = overTarget;
    
    // Color-code the summary numbers
    document.getElementById('on-target').className = 'stat-number target';
    document.getElementById('under-target').className = underTarget > 0 ? 'stat-number low' : 'stat-number';
    document.getElementById('over-target').className = overTarget > 0 ? 'stat-number high' : 'stat-number';
}

function getCountClass(count, min, max) {
    if (count < min) return 'count-low';
    if (count > max) return 'count-high';
    return 'count-target';
}
</script>
