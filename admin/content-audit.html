---
layout: default
title: "Content Audit Dashboard"
permalink: /admin/content-audit/
---

<style>
.audit-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
}

.audit-header {
    text-align: center;
    margin-bottom: 2rem;
}

.audit-controls {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    text-align: center;
}

.analyze-btn {
    background: #007acc;
    color: white;
    border: none;
    padding: 1rem 2rem;
    border-radius: 6px;
    font-size: 1.1rem;
    cursor: pointer;
    margin-bottom: 1rem;
}

.analyze-btn:hover {
    background: #005999;
}

.results-table {
    background: white;
    border-radius: 8px;
    overflow-x: auto;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    display: none;
}

table {
    width: 100%;
    border-collapse: collapse;
}

th, td {
    padding: 0.8rem;
    text-align: left;
    border-bottom: 1px solid #eee;
    font-size: 0.9rem;
}

th {
    background: #f8f9fa;
    font-weight: 600;
    position: sticky;
    top: 0;
}

.article-title {
    max-width: 200px;
    font-weight: 500;
}

.article-title a {
    text-decoration: none;
    color: #007acc;
}

.word-count {
    text-align: center;
    font-weight: 500;
    padding: 0.3rem 0.6rem;
    border-radius: 4px;
}

.count-low { background: #ffebee; color: #c62828; }
.count-target { background: #e8f5e8; color: #2e7d32; }
.count-high { background: #fff3e0; color: #f57c00; }

.condition-badge {
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
}

.condition-adhd { background: #ffebee; color: #d63031; }
.condition-autism { background: #d4edda; color: #27ae60; }
.condition-bipolar { background: #e3f2fd; color: #74b9ff; }
.condition-bpd { background: #fef9e7; color: #f39c12; }
.condition-ocd { background: #f3e5f5; color: #9c27b0; }

.summary-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
    display: none;
}

.stat-card {
    background: white;
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.stat-number {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.3rem;
}

.loading {
    text-align: center;
    padding: 2rem;
    display: none;
}
</style>

<div class="audit-container">
    <div class="audit-header">
        <h1>Content Audit Dashboard</h1>
        <p>Automated word count analysis for all struggle articles</p>
    </div>

    <div class="audit-controls">
        <button class="analyze-btn" onclick="analyzeAllArticles()">Analyze All Articles</button>
        <p>Click to fetch and analyze word counts for all struggle pages</p>
        <div class="loading" id="loading">
            <p>Analyzing articles... <span id="progress">0</span> of <span id="total">0</span> complete</p>
        </div>
    </div>

    <div class="summary-stats" id="summary-stats">
        <div class="stat-card">
            <div class="stat-number" id="total-count">0</div>
            <div>Total Articles</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="avg-words">0</div>
            <div>Average Words</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="on-target">0</div>
            <div>On Target</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="under-target">0</div>
            <div>Under Target</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="over-target">0</div>
            <div>Over Target</div>
        </div>
    </div>

    <div class="results-table" id="results-table">
        <table>
            <thead>
                <tr>
                    <th>Article</th>
                    <th>Condition</th>
                    <th>Total</th>
                    <th>What (300-400)</th>
                    <th>Why (~400)</th>
                    <th>Next 5 (300-500)</th>
                    <th>Long-term (~550)</th>
                    <th>Medical (200-300)</th>
                    <th>Validation (~400)</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="results-body">
                <!-- Results populated by JavaScript -->
            </tbody>
        </table>
    </div>
</div>

<!-- Article URLs for analysis -->
<div style="display: none;" id="article-data">
{% for page in site.pages %}
  {% if page.layout == 'struggle' %}
  <div data-title="{{ page.title }}" 
       data-url="{{ page.url }}" 
       data-condition="{{ page.condition }}"
       data-status="{{ page.status | default: 'published' }}"></div>
  {% endif %}
{% endfor %}
</div>

<script>
async function analyzeAllArticles() {
    const button = document.querySelector('.analyze-btn');
    const loading = document.getElementById('loading');
    const resultsTable = document.getElementById('results-table');
    const summaryStats = document.getElementById('summary-stats');
    
    button.disabled = true;
    button.textContent = 'Analyzing...';
    loading.style.display = 'block';
    
    // Get article list from Jekyll data
    const articleElements = document.querySelectorAll('#article-data div[data-title]');
    const articles = Array.from(articleElements).map(el => ({
        title: el.dataset.title,
        url: el.dataset.url,
        condition: el.dataset.condition,
        status: el.dataset.status
    }));
    
    document.getElementById('total').textContent = articles.length;
    
    const results = [];
    
    for (let i = 0; i < articles.length; i++) {
        const article = articles[i];
        document.getElementById('progress').textContent = i + 1;
        
        try {
            // Fetch the article content
            const response = await fetch(article.url);
            const html = await response.text();
            
            // Parse HTML and extract sections
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // Count words in each section
            const sections = {
                what: countSectionWords(doc, '.what-section'),
                why: countSectionWords(doc, '.why-section'),
                nextFive: countSectionWords(doc, '.immediate-help'),
                longTerm: countSectionWords(doc, '.long-term'),
                medical: countSectionWords(doc, '.medical-section'),
                validation: countSectionWords(doc, '.validation-section')
            };
            
            const totalWords = Object.values(sections).reduce((a, b) => a + b, 0);
            const onTarget = totalWords >= 2150 && totalWords <= 2550;
            
            results.push({
                ...article,
                sections,
                totalWords,
                onTarget
            });
            
        } catch (error) {
            console.error(`Error analyzing ${article.title}:`, error);
            results.push({
                ...article,
                sections: { what: 0, why: 0, nextFive: 0, longTerm: 0, medical: 0, validation: 0 },
                totalWords: 0,
                onTarget: false,
                error: true
            });
        }
    }
    
    // Sort by total word count (lowest first to highlight issues)
    results.sort((a, b) => a.totalWords - b.totalWords);
    
    // Render results
    renderResults(results);
    updateSummaryStats(results);
    
    // Show results and hide loading
    loading.style.display = 'none';
    resultsTable.style.display = 'block';
    summaryStats.style.display = 'grid';
    button.disabled = false;
    button.textContent = 'Re-analyze All Articles';
}

function countSectionWords(doc, selector) {
    const section = doc.querySelector(selector);
    if (!section) return 0;
    
    // Remove tooltip content from word count
    const clone = section.cloneNode(true);
    const tooltips = clone.querySelectorAll('.tooltip');
    tooltips.forEach(tooltip => tooltip.remove());
    
    // Get text content and count words
    const text = clone.textContent || clone.innerText || '';
    const words = text.trim().split(/\s+/).filter(word => word.length > 0);
    return words.length;
}

function renderResults(results) {
    const tbody = document.getElementById('results-body');
    tbody.innerHTML = '';
    
    results.forEach(article => {
        const row = document.createElement('tr');
        
        const statusClass = article.totalWords < 2150 ? 'under' : 
                           article.totalWords > 2550 ? 'over' : 'target';
        
        row.innerHTML = `
            <td class="article-title">
                <a href="${article.url}" target="_blank">${article.title}</a>
            </td>
            <td>
                <span class="condition-badge condition-${article.condition}">
                    ${article.condition.toUpperCase()}
                </span>
            </td>
            <td>
                <span class="word-count ${getCountClass(article.totalWords, 2150, 2550)}">
                    ${article.totalWords}
                </span>
            </td>
            <td>
                <span class="word-count ${getCountClass(article.sections.what, 300, 400)}">
                    ${article.sections.what}
                </span>
            </td>
            <td>
                <span class="word-count ${getCountClass(article.sections.why, 380, 420)}">
                    ${article.sections.why}
                </span>
            </td>
            <td>
                <span class="word-count ${getCountClass(article.sections.nextFive, 300, 500)}">
                    ${article.sections.nextFive}
                </span>
            </td>
            <td>
                <span class="word-count ${getCountClass(article.sections.longTerm, 500, 600)}">
                    ${article.sections.longTerm}
                </span>
            </td>
            <td>
                <span class="word-count ${getCountClass(article.sections.medical, 200, 300)}">
                    ${article.sections.medical}
                </span>
            </td>
            <td>
                <span class="word-count ${getCountClass(article.sections.validation, 380, 420)}">
                    ${article.sections.validation}
                </span>
            </td>
            <td>
                <span class="word-count ${statusClass === 'target' ? 'count-target' : 'count-low'}">
                    ${statusClass === 'target' ? '✓' : '⚠'}
                </span>
            </td>
        `;
        
        tbody.appendChild(row);
    });
}

function getCountClass(count, min, max) {
    if (count < min) return 'count-low';
    if (count > max) return 'count-high';
    return 'count-target';
}

function updateSummaryStats(results) {
    document.getElementById('total-count').textContent = results.length;
    
    const avgWords = Math.round(
        results.reduce((sum, a) => sum + a.totalWords, 0) / results.length
    );
    document.getElementById('avg-words').textContent = avgWords;
    
    document.getElementById('on-target').textContent = 
        results.filter(a => a.onTarget).length;
    document.getElementById('under-target').textContent = 
        results.filter(a => a.totalWords < 2150).length;
    document.getElementById('over-target').textContent = 
        results.filter(a => a.totalWords > 2550).length;
}
</script>
