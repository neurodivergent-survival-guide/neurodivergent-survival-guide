<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Struggle Links Validator</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #d63031;
            padding-bottom: 10px;
        }
        .section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .issue {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px;
            margin: 10px 0;
        }
        .error {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 10px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 10px;
            margin: 10px 0;
        }
        .file-upload {
            padding: 20px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }
        textarea {
            width: 100%;
            height: 200px;
            font-family: monospace;
            font-size: 12px;
        }
        button {
            background: #d63031;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #b71c1c;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #d63031;
        }
        ul {
            line-height: 1.8;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>üîç Struggle Links Validator</h1>
    
    <div class="section">
        <h2>Step 1: Define Your Valid Struggles</h2>
        <p>Paste your <code>_data/struggle_order.yml</code> content here to define all valid struggle slugs:</p>
        <textarea id="struggleData" placeholder="Paste your struggle_order.yml content here..."></textarea>
        <button onclick="parseStruggleData()">Parse Struggle Data</button>
        <div id="parseResults"></div>
    </div>

    <div class="section">
        <h2>Step 2: Check Individual Struggle Pages</h2>
        <p>Paste the HTML content of any struggle page to validate its related struggles links:</p>
        <textarea id="pageContent" placeholder="Paste HTML content of a struggle page here..."></textarea>
        <button onclick="validatePage()">Validate Related Struggles</button>
        <div id="validationResults"></div>
    </div>

    <div class="section">
        <h2>Step 3: Batch Validation Report</h2>
        <p>Generate a comprehensive report of all issues found:</p>
        <button onclick="generateReport()">Generate Full Report</button>
        <div id="reportResults"></div>
    </div>

    <script>
        let validSlugs = new Set();
        let strugglesByCondition = {};
        
        function parseStruggleData() {
            const data = document.getElementById('struggleData').value;
            validSlugs.clear();
            strugglesByCondition = {};
            
            try {
                // Parse YAML-like structure
                const conditions = ['adhd:', 'autism:', 'bipolar:', 'bpd:', 'ocd:'];
                let currentCondition = null;
                
                const lines = data.split('\n');
                lines.forEach(line => {
                    // Check for condition headers
                    conditions.forEach(condition => {
                        if (line.includes(condition)) {
                            currentCondition = condition.replace(':', '');
                            strugglesByCondition[currentCondition] = [];
                        }
                    });
                    
                    // Extract slug
                    if (line.includes('slug:')) {
                        const slug = line.match(/slug:\s*"([^"]+)"/);
                        if (slug) {
                            validSlugs.add(slug[1]);
                            if (currentCondition) {
                                strugglesByCondition[currentCondition].push(slug[1]);
                            }
                        }
                    }
                });
                
                // Display results
                let html = '<div class="stats">';
                html += `<div class="stat-card"><div class="stat-number">${validSlugs.size}</div><div>Total Valid Struggles</div></div>`;
                
                for (const [condition, struggles] of Object.entries(strugglesByCondition)) {
                    html += `<div class="stat-card"><div class="stat-number">${struggles.length}</div><div>${condition.toUpperCase()} Struggles</div></div>`;
                }
                html += '</div>';
                
                html += '<div class="success">‚úÖ Successfully parsed ' + validSlugs.size + ' valid struggle slugs</div>';
                html += '<details><summary>View all valid slugs</summary><ul>';
                Array.from(validSlugs).sort().forEach(slug => {
                    html += `<li><code>${slug}</code></li>`;
                });
                html += '</ul></details>';
                
                document.getElementById('parseResults').innerHTML = html;
            } catch (error) {
                document.getElementById('parseResults').innerHTML = 
                    '<div class="error">‚ùå Error parsing data: ' + error.message + '</div>';
            }
        }
        
        function validatePage() {
            const content = document.getElementById('pageContent').value;
            if (validSlugs.size === 0) {
                document.getElementById('validationResults').innerHTML = 
                    '<div class="error">‚ö†Ô∏è Please parse struggle data first!</div>';
                return;
            }
            
            let issues = [];
            let validLinks = [];
            
            // Extract related struggles section
            const relatedSection = content.match(/<div class="related-struggles">[\s\S]*?<\/div>\s*<\/div>/);
            if (!relatedSection) {
                document.getElementById('validationResults').innerHTML = 
                    '<div class="error">‚ùå No related struggles section found</div>';
                return;
            }
            
            // Extract all links
            const linkPattern = /<a href="[^"]*\/struggles\/([^"]+)\.html[^"]*"[^>]*class="struggle-tag"[^>]*>([^<]+)<\/a>/g;
            let match;
            let linkCount = 0;
            
            while ((match = linkPattern.exec(relatedSection[0])) !== null) {
                linkCount++;
                const slug = match[1];
                const linkText = match[2];
                
                // Check for condition suffixes in link text
                if (linkText.match(/\(ADHD\)|\(Autism\)|\(Bipolar\)|\(BPD\)|\(OCD\)/)) {
                    issues.push({
                        type: 'naming',
                        message: `Link text contains condition suffix: "${linkText}" - should be without condition suffix`,
                        slug: slug
                    });
                }
                
                // Check if slug exists
                if (!validSlugs.has(slug)) {
                    issues.push({
                        type: 'invalid',
                        message: `Invalid struggle link: "${slug}" does not exist in struggle_order.yml`,
                        linkText: linkText
                    });
                } else {
                    validLinks.push({slug: slug, text: linkText});
                }
            }
            
            // Check link count (should be 4 or 5)
            if (linkCount !== 4 && linkCount !== 5) {
                issues.push({
                    type: 'count',
                    message: `Found ${linkCount} related struggle links - should be exactly 4 or 5`
                });
            }
            
            // Display results
            let html = '<h3>Validation Results</h3>';
            
            if (issues.length === 0) {
                html += '<div class="success">‚úÖ All related struggles links are valid!</div>';
                html += `<p>Found ${linkCount} valid links:</p><ul>`;
                validLinks.forEach(link => {
                    html += `<li>‚úì <code>${link.slug}</code> ‚Üí "${link.text}"</li>`;
                });
                html += '</ul>';
            } else {
                html += `<div class="error">‚ùå Found ${issues.length} issue(s):</div>`;
                issues.forEach(issue => {
                    if (issue.type === 'naming') {
                        html += `<div class="issue"><strong>Naming Issue:</strong> ${issue.message}<br>`;
                        html += `Fix: Remove condition suffix from link text</div>`;
                    } else if (issue.type === 'invalid') {
                        html += `<div class="error"><strong>Invalid Link:</strong> ${issue.message}<br>`;
                        html += `Link text: "${issue.linkText}"</div>`;
                    } else if (issue.type === 'count') {
                        html += `<div class="issue"><strong>Link Count:</strong> ${issue.message}</div>`;
                    }
                });
                
                if (validLinks.length > 0) {
                    html += '<h4>Valid Links Found:</h4><ul>';
                    validLinks.forEach(link => {
                        html += `<li>‚úì <code>${link.slug}</code> ‚Üí "${link.text}"</li>`;
                    });
                    html += '</ul>';
                }
            }
            
            document.getElementById('validationResults').innerHTML = html;
        }
        
        function generateReport() {
            if (validSlugs.size === 0) {
                document.getElementById('reportResults').innerHTML = 
                    '<div class="error">‚ö†Ô∏è Please parse struggle data first!</div>';
                return;
            }
            
            let html = '<h3>üìã Complete Validation Checklist</h3>';
            html += '<div class="success">Valid struggle slugs loaded: ' + validSlugs.size + '</div>';
            
            html += '<h4>Common Issues to Check:</h4>';
            html += '<ol>';
            html += '<li><strong>Condition Suffixes:</strong> Search for "(ADHD)", "(Autism)", "(Bipolar)", "(BPD)", "(OCD)" in link text - these should be removed</li>';
            html += '<li><strong>Link Count:</strong> Each struggle page should have exactly 4 or 5 related struggles</li>';
            html += '<li><strong>Valid Slugs:</strong> All linked struggles should exist in struggle_order.yml</li>';
            html += '<li><strong>Cross-condition Links:</strong> Some struggles can link to struggles from other conditions if relevant</li>';
            html += '</ol>';
            
            html += '<h4>Quick Fix Commands:</h4>';
            html += '<pre>';
            html += '# Find all pages with condition suffixes in links\n';
            html += 'grep -r "(ADHD)\\|(Autism)\\|(Bipolar)\\|(BPD)\\|(OCD)" struggles/*.html\n\n';
            html += '# Count related struggles in each file\n';
            html += 'for file in struggles/*.html; do\n';
            html += '  count=$(grep -c \'class="struggle-tag"\' "$file")\n';
            html += '  if [ $count -ne 4 ] && [ $count -ne 5 ]; then\n';
            html += '    echo "$file: $count links (should be 4 or 5)"\n';
            html += '  fi\n';
            html += 'done';
            html += '</pre>';
            
            html += '<h4>All Valid Struggle Slugs by Condition:</h4>';
            for (const [condition, struggles] of Object.entries(strugglesByCondition)) {
                html += `<details><summary><strong>${condition.toUpperCase()}</strong> (${struggles.length} struggles)</summary><ul>`;
                struggles.forEach(slug => {
                    html += `<li><code>${slug}</code></li>`;
                });
                html += '</ul></details>';
            }
            
            document.getElementById('reportResults').innerHTML = html;
        }
    </script>
</body>
</html>
