---
layout: default
title: "The Neurodivergent Survival Guide"
---
<!-- index.html -->
<!-- Add Fuse.js CDN to head section -->
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

<style>
    :root {
        --aurora-start: #1e3c72;
        --aurora-mid: #2a5298;
        --aurora-end: #764ba2;
        --rainbow-1: #ff6b6b;
        --rainbow-2: #feca57;
        --rainbow-3: #48dbfb;
        --rainbow-4: #ff9ff3;
        --rainbow-5: #54a0ff;
        --rainbow-6: #5f27cd;
        --text-primary: #333;
        --text-secondary: #555;
        --text-light: #666;
        --card-background: rgba(255, 255, 255, 0.95);
        --glass-background: rgba(255, 255, 255, 0.1);
        --glass-border: rgba(255, 255, 255, 0.2);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        font-weight: 500;
        background: linear-gradient(135deg, var(--aurora-start) 0%, var(--aurora-mid) 50%, var(--aurora-end) 100%);
        background-size: 400% 400%;
        animation: auroraShift 20s ease infinite;
        color: var(--text-primary);
        min-height: 100vh;
        line-height: 1.7;
        position: relative;
        overflow-x: hidden;
    }

    @keyframes auroraShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 20% 80%, var(--rainbow-1) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, var(--rainbow-2) 0%, transparent 50%),
            radial-gradient(circle at 40% 40%, var(--rainbow-3) 0%, transparent 50%);
        opacity: 0.1;
        z-index: -2;
        animation: floatColors 30s ease-in-out infinite;
    }

    @keyframes floatColors {
        0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.1; }
        50% { transform: translateY(-20px) rotate(5deg); opacity: 0.15; }
    }

    body::after {
        content: '∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞ ∞';
        position: fixed;
        top: 0;
        left: 0;
        width: 200%;
        height: 200%;
        font-size: 2rem;
        color: rgba(255, 255, 255, 0.03);
        z-index: -1;
        transform: rotate(-15deg);
        line-height: 4rem;
        pointer-events: none;
        animation: infinityFloat 40s linear infinite;
    }

    @keyframes infinityFloat {
        0% { transform: rotate(-15deg) translateX(0); }
        100% { transform: rotate(-15deg) translateX(-50%); }
    }

    .hero {
        background: var(--glass-background);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        padding: 3rem 2rem;
        text-align: center;
        border-bottom: 1px solid var(--glass-border);
        position: relative;
    }

    .hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, 
            var(--rainbow-1), var(--rainbow-2), var(--rainbow-3), 
            var(--rainbow-4), var(--rainbow-5), var(--rainbow-6), var(--rainbow-1));
        background-size: 300% 100%;
        animation: rainbowShift 8s ease infinite;
    }

    @keyframes rainbowShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    .hero h1 {
        color: white;
        font-size: 2.5rem;
        font-weight: 300;
        margin-bottom: 1rem;
        background: linear-gradient(135deg, #fff, #e0e7ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .hero p {
        color: rgba(255, 255, 255, 0.9);
        font-size: 1.2rem;
        max-width: 600px;
        margin: 0 auto 2rem;
    }

    /* Enhanced Search Styles */
    .search-section {
        max-width: 500px;
        margin: 2rem auto 0;
        position: relative;
    }

    .search-box {
        width: 100%;
        padding: 1rem 1.5rem;
        font-size: 1.1rem;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 25px;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        color: white;
        outline: none;
        transition: all 0.3s ease;
    }

    .search-box::placeholder {
        color: rgba(255, 255, 255, 0.7);
    }

    .search-box:focus {
        border-color: var(--rainbow-3);
        background: rgba(255, 255, 255, 0.25);
        box-shadow: 0 0 0 3px rgba(72, 219, 251, 0.2);
        border-radius: 25px 25px 12px 12px;
    }

    .search-icon {
        position: absolute;
        right: 1.5rem;
        top: 50%;
        transform: translateY(-50%);
        color: rgba(255, 255, 255, 0.7);
        font-size: 1.2rem;
        pointer-events: none;
    }

    /* Search Results Dropdown */
    .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(15px);
        border-radius: 0 0 16px 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        max-height: 400px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-top: none;
    }

    .search-results.show {
        display: block;
    }

    .search-result-item {
        padding: 12px 20px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        cursor: pointer;
        transition: background-color 0.2s ease;
        text-decoration: none;
        color: inherit;
        display: block;
    }

    .search-result-item:hover {
        background: rgba(72, 219, 251, 0.1);
        text-decoration: none;
        color: inherit;
    }

    .search-result-item:last-child {
        border-bottom: none;
    }

    .result-title {
        font-weight: 600;
        color: #333;
        margin-bottom: 4px;
        font-size: 0.95rem;
    }

    .result-condition {
        display: inline-block;
        background: var(--rainbow-3);
        color: white;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.75rem;
        font-weight: 500;
        margin-left: 8px;
        text-transform: uppercase;
    }

    .result-condition.adhd { background: #d63031; }
    .result-condition.autism { background: #27ae60; }
    .result-condition.bipolar { background: #74b9ff; }
    .result-condition.bpd { background: #f39c12; }
    .result-condition.ocd { background: #a29bfe; }

    .result-description {
        color: #666;
        font-size: 0.85rem;
        line-height: 1.4;
        margin-top: 4px;
    }

    .no-results {
        padding: 20px;
        text-align: center;
        color: #666;
        font-style: italic;
    }

    .search-hint {
        padding: 12px 20px;
        background: rgba(72, 219, 251, 0.05);
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        font-size: 0.8rem;
        color: #666;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
        width: 100%;
        box-sizing: border-box;
    }

    .intro-section {
        background: var(--card-background);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2.5rem;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        margin-bottom: 3rem;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .intro-section h2 {
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        font-size: 1.8rem;
        font-weight: 400;
    }

    .intro-section p {
        font-size: 1.1rem;
        color: var(--text-secondary);
        margin-bottom: 1.5rem;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
    }

    .main-sections {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 2rem;
        margin: 3rem 0;
    }

    .section-card {
        background: var(--card-background);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        cursor: pointer;
        text-decoration: none;
        color: inherit;
        border: 1px solid rgba(255, 255, 255, 0.2);
        position: relative;
        overflow: hidden;
    }

    .section-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .conditions-card::before {
        background: linear-gradient(90deg, var(--rainbow-4), var(--rainbow-1));
    }

    .struggles-card::before {
        background: linear-gradient(90deg, var(--rainbow-3), var(--rainbow-5));
    }

    .toolkits-card::before {
        background: linear-gradient(90deg, #8b7355, #5d4037);
    }

    .section-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 45px rgba(0, 0, 0, 0.12);
        color: inherit;
        text-decoration: none;
    }

    .section-card:hover::before {
        opacity: 1;
    }

    .card-icon {
        width: 60px;
        height: 60px;
        border-radius: 15px;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        position: relative;
        overflow: hidden;
    }

    .conditions-card .card-icon {
        background: linear-gradient(45deg, var(--rainbow-4), var(--rainbow-1));
    }

    .struggles-card .card-icon {
        background: linear-gradient(45deg, var(--rainbow-3), var(--rainbow-5));
    }

    .toolkits-card .card-icon {
        background: linear-gradient(45deg, #8b7355, #5d4037);
    }

    .section-card h3 {
        font-size: 1.4rem;
        margin-bottom: 1rem;
        color: var(--text-primary);
    }

    .section-card p {
        color: var(--text-light);
        margin-bottom: 1rem;
    }

    .section-examples {
        font-size: 0.9rem;
        color: #888;
        font-style: italic;
    }

    .how-it-works {
        background: var(--card-background);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2.5rem;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        margin: 3rem 0;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .how-it-works h2 {
        color: var(--text-primary);
        margin-bottom: 2rem;
        font-size: 1.8rem;
        font-weight: 400;
        text-align: center;
    }

    .workflow-steps {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
        margin-top: 2rem;
    }

    .workflow-step {
        text-align: center;
        padding: 1.5rem;
        background: rgba(248, 249, 255, 0.8);
        backdrop-filter: blur(5px);
        border-radius: 16px;
        border-left: 4px solid var(--rainbow-3);
        transition: all 0.3s ease;
    }

    .workflow-step:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
    }

    .step-number {
        display: inline-block;
        width: 40px;
        height: 40px;
        background: linear-gradient(45deg, var(--rainbow-3), var(--rainbow-5));
        color: white;
        border-radius: 50%;
        line-height: 40px;
        font-weight: 600;
        margin-bottom: 1rem;
    }

    .workflow-step h4 {
        color: var(--rainbow-5);
        margin-bottom: 0.8rem;
        font-size: 1.1rem;
    }

    .workflow-step p {
        color: var(--text-secondary);
        font-size: 0.95rem;
    }

    .quick-access {
        background: var(--card-background);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
        margin: 3rem 0;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .quick-access h3 {
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        font-size: 1.4rem;
    }

    .quick-links {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1.5rem;
    }

    .quick-link {
        background: rgba(248, 249, 255, 0.8);
        backdrop-filter: blur(5px);
        padding: 1rem 1.5rem;
        border-radius: 12px;
        text-decoration: none;
        color: var(--rainbow-5);
        font-weight: 500;
        transition: all 0.3s ease;
        border-left: 3px solid var(--rainbow-3);
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .quick-link:hover {
        background: var(--rainbow-3);
        color: white;
        text-decoration: none;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(72, 219, 251, 0.3);
    }

    .tip-jar {
        background: rgba(255, 248, 240, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
        text-align: center;
        margin: 3rem 0;
        border: 1px solid rgba(255, 165, 0, 0.2);
        border-left: 4px solid #ff7675;
    }

    .tip-jar h3 {
        color: #ff7675;
        margin-bottom: 1rem;
        font-size: 1.3rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }

    .tip-jar p {
        color: var(--text-secondary);
        margin-bottom: 1rem;
        font-size: 0.95rem;
    }

    .tip-jar .kofi-info {
        background: rgba(255, 255, 255, 0.8);
        padding: 1rem;
        border-radius: 12px;
        margin: 1.5rem 0;
        font-weight: 600;
        color: #333;
        border: 2px solid rgba(255, 118, 117, 0.3);
    }

    .disclaimer {
        background: rgba(255, 242, 242, 0.9);
        backdrop-filter: blur(10px);
        border: 1px solid #ffcccb;
        padding: 1.5rem;
        border-radius: 16px;
        margin: 2rem 0;
    }

    .disclaimer h4 {
        color: #d63031;
        margin-bottom: 0.8rem;
        font-size: 1.2rem;
    }

    .disclaimer p {
        color: var(--text-secondary);
        font-size: 0.95rem;
        margin-bottom: 0.8rem;
    }

    .footer-note {
        background: var(--card-background);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
        text-align: center;
        margin: 3rem 0;
        border-left: 4px solid #6c5ce7;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .footer-note h3 {
        color: #6c5ce7;
        margin-bottom: 1rem;
        font-size: 1.3rem;
    }

    .footer-note p {
        color: var(--text-secondary);
        margin-bottom: 1rem;
        font-size: 0.95rem;
    }

    /* Jargon tooltip styles */
    .jargon {
        color: #e84393;
        text-decoration: none;
        border-bottom: 1px dotted #e84393;
        position: relative;
        cursor: help;
        font-weight: 500;
    }

    .jargon:hover {
        color: #fd79a8;
        border-bottom-color: #fd79a8;
    }

    .tooltip {
        visibility: hidden;
        opacity: 0;
        position: absolute;
        bottom: calc(100% + 8px);
        left: 50%;
        transform: translateX(-50%);
        background: #333;
        color: white;
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 0.9rem;
        font-weight: normal;
        z-index: 1001;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        transition: opacity 0.3s, visibility 0.3s;
        max-width: 800px;
        min-width: 200px;
        width: max-content;
        white-space: normal;
        text-align: left;
        line-height: 1.5;
        pointer-events: none;
    }

    .tooltip::after {
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border: 6px solid transparent;
        border-top-color: #333;
    }

    .jargon:hover .tooltip {
        visibility: visible;
        opacity: 1;
    }

    /* Focus states for accessibility */
    .section-card:focus,
    .quick-link:focus,
    .jargon:focus,
    .search-box:focus {
        outline: 2px solid #fff;
        outline-offset: 2px;
    }

    /* Motion accessibility */
    @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
        
        body::before,
        body::after {
            animation: none !important;
        }
        
        .hero::before {
            animation: none !important;
        }
    }

    /* Mobile responsive */
    @media (max-width: 1024px) {
        .search-results {
            max-height: 300px;
        }
    }

    @media (max-width: 768px) {
        .search-section {
            max-width: 90%;
        }
        
        .search-results {
            max-height: 250px;
        }
        
        .result-title {
            font-size: 0.9rem;
        }
        
        .result-description {
            font-size: 0.8rem;
        }

        .hero {
            padding: 2rem 1rem;
        }

        .hero h1 {
            font-size: 2rem;
        }

        .container {
            padding: 1rem;
        }

        .intro-section,
        .how-it-works,
        .quick-access,
        .tip-jar,
        .footer-note {
            padding: 1.5rem;
        }

        .main-sections {
            grid-template-columns: 1fr;
            max-width: none;
        }

        .workflow-steps {
            grid-template-columns: 1fr;
        }

        .quick-links {
            grid-template-columns: 1fr;
        }

        .disclaimer {
            padding: 1.2rem;
        }
    }

    @media (max-width: 480px) {
        .hero h1 {
            font-size: 1.8rem;
        }

        .hero p {
            font-size: 1rem;
        }

        .intro-section,
        .how-it-works,
        .quick-access,
        .tip-jar,
        .footer-note {
            padding: 1.2rem;
        }
    }
</style>

<div class="hero">
    <h1>The Neurodivergent Survival Guide</h1>
    <p>Navigate daily friction points with understanding, practical tools, and community wisdom from those who understand the journey</p>
    
    <div class="search-section">
        <input type="text" class="search-box" placeholder="Search for conditions, struggles, or symptoms..." id="searchBox">
        <div class="search-results" id="searchResults"></div>
        <span class="search-icon">🔍</span>
    </div>
</div>

<div class="container">
    <main role="main" id="main-content">
        <div class="intro-section" id="get-started">
            <h2>Understanding Your Daily Struggles</h2>
            <p>If you're here, daily life probably feels harder than it should. Maybe conversations drain you, simple tasks feel impossible, or you can't figure out why everyone else seems to have an instruction manual you never received.</p>
            <p>You're not broken. Your brain just works differently in a world designed for different types of processors. The friction you experience comes from this mismatch, not from any flaw in you.</p>
            <p>This guide helps you understand why specific situations create challenges and gives you practical tools to navigate them. It's organized around real daily experiences, not clinical categories.</p>
        </div>

        <div class="main-sections">
            <a href="{{ '/conditions/index.html' | relative_url }}" class="section-card conditions-card">
                <div class="card-icon">🧠</div>
                <h3>Understand Your Brain</h3>
                <p>Comprehensive guides to how different neurotypes create friction in daily life. Learn about the broader patterns that might explain multiple struggles you're experiencing.</p>
                <div class="section-examples">Autism • ADHD • Bipolar • BPD • OCD</div>
            </a>

            <a href="{{ '/struggles/index.html' | relative_url }}" class="section-card struggles-card">
                <div class="card-icon">⚡</div>
                <h3>Navigate Daily Friction</h3>
                <p>Practical guides for specific situations that create challenges. Each includes what it feels like, why it happens, and immediate + long-term strategies that actually work.</p>
                <div class="section-examples">Communication • Executive function • Sensory overload • Emotional regulation</div>
            </a>

            <a href="{{ '/toolkits/index.html' | relative_url }}" class="section-card toolkits-card">
                <div class="card-icon">💼</div>
                <h3>Strategic System Navigation</h3>
                <p>Step-by-step guidance for advocating within institutional systems. Professional tools for workplace accommodations, healthcare navigation, and legal advocacy.</p>
                <div class="section-examples">Workplace advocacy • Healthcare systems • Educational accommodations • Financial management</div>
            </a>
        </div>

        <div class="quick-access">
            <h3>Popular Starting Points</h3>
            <p style="color: #666; margin-bottom: 1.5rem;">Jump directly to commonly accessed topics</p>
            <div class="quick-links">
                <a href="{{ '/struggles/task-initiation-paralysis.html' | relative_url }}" class="quick-link">Task Initiation Paralysis</a>
                <a href="{{ '/conditions/autism.html' | relative_url }}" class="quick-link">Autism Guide</a>
                <a href="{{ '/conditions/adhd.html' | relative_url }}" class="quick-link">ADHD Guide</a>
                <a href="{{ '/struggles/working-memory-difficulties.html' | relative_url }}" class="quick-link">Working Memory Difficulties</a>
                <a href="{{ '/conditions/bipolar.html' | relative_url }}" class="quick-link">Bipolar Guide</a>
            </div>
        </div>

        <div class="tip-jar">
            <h3>❤️ Support This Resource</h3>
            <p>This guide represents hundreds of hours of research, lived experience, and careful writing to help our community navigate daily challenges. If these resources have helped you understand yourself better or made your day a little easier, consider supporting the project.</p>
            <p><strong>All donations help:</strong> Keep this resource completely free • Cover hosting and maintenance costs • Fund ongoing research and content updates • Allow more time for creating new resources</p>
            <div class="kofi-info">
                <a href="https://ko-fi.com/neurodivergent_survival_guide" target="_blank" style="text-decoration: none; color: #333; font-weight: 600;">
                    <strong>Ko-fi.com/neurodivergent_survival_guide</strong>
                </a>
            </div>
            <p style="font-style: italic; color: #666; font-size: 0.9rem;">This guide will always remain free regardless of donations. Support only if this resource has genuinely helped you.</p>
        </div>

        <div class="how-it-works">
            <h2>How This Guide Works</h2>
            <div class="workflow-steps">
                <div class="workflow-step">
                    <div class="step-number">1</div>
                    <h4>Start Where You Are</h4>
                    <p>Enter through any point - a daily struggle, a condition you're exploring, or a term you heard. All paths connect to build understanding.</p>
                </div>

                <div class="workflow-step">
                    <div class="step-number">2</div>
                    <h4>Understand the Why</h4>
                    <p>Learn what's happening in your brain and why certain situations create friction. Knowledge reduces self-blame and shame.</p>
                </div>

                <div class="workflow-step">
                    <div class="step-number">3</div>
                    <h4>Build Your Toolkit</h4>
                    <p>Get immediate strategies and long-term approaches that work for your life. Explore connected topics to build fuller understanding.</p>
                </div>
            </div>
        </div>

        <div class="disclaimer">
            <h4>Important Disclaimer</h4>
            <p>This guide is for educational and self-understanding purposes only. It is not intended to diagnose, treat, or replace professional medical or mental health care. If you're experiencing significant distress or impairment, please consult with qualified healthcare professionals.</p>
            <p><strong>Crisis Resources:</strong> Emergency: 911 | Suicide & Crisis Lifeline: 988 | Crisis Text Line: Text HOME to 741741</p>
        </div>

        <div class="footer-note">
            <h3>A Living Resource</h3>
            <p>This guide grows and improves based on community feedback and new research. It's built by and for <a class="jargon">neurodivergent<span class="tooltip">Brain differences that create distinct patterns of thinking, processing, and behavior</span></a> people who understand these struggles from lived experience.</p>
            <p>Every person's experience is unique. Take what helps, leave what doesn't, and remember that understanding yourself is a gradual process, not a destination.</p>
        </div>
    </main>
</div>

<script>
// Enhanced Search Implementation with Fuse.js
let searchIndex = null;
let fuse = null;

// Initialize search when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    initializeSearch();
});

async function initializeSearch() {
    try {
        // Load the search index - use Jekyll's relative_url filter to handle subpaths
        const response = await fetch('{{ "/search-index.json" | relative_url }}');
        searchIndex = await response.json();
        
        // Configure Fuse.js for fuzzy search
        const fuseOptions = {
            keys: [
                { name: 'title', weight: 0.4 },
                { name: 'subtitle', weight: 0.3 },
                { name: 'search_terms', weight: 0.2 },
                { name: 'description', weight: 0.1 }
            ],
            threshold: 0.4, // Lower = more strict matching
            distance: 100,
            minMatchCharLength: 2,
            includeScore: true,
            includeMatches: true
        };
        
        fuse = new Fuse(searchIndex, fuseOptions);
        
        // Set up search interface
        setupSearchInterface();
        
    } catch (error) {
        console.error('Failed to load search index:', error);
        // Fallback to simple routing if search index fails
        setupFallbackSearch();
    }
}

function setupSearchInterface() {
    const searchBox = document.getElementById('searchBox');
    const searchResults = document.getElementById('searchResults');
    
    if (!searchBox || !searchResults) {
        console.error('Search elements not found');
        return;
    }
    
    let searchTimeout;
    
    // Search as user types (with debouncing)
    searchBox.addEventListener('input', function(e) {
        clearTimeout(searchTimeout);
        const query = e.target.value.trim();
        
        if (query.length < 2) {
            hideSearchResults();
            return;
        }
        
        searchTimeout = setTimeout(() => {
            performSearch(query);
        }, 200); // 200ms delay to avoid excessive searching
    });
    
    // Handle keyboard navigation
    searchBox.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            const firstResult = searchResults.querySelector('.search-result-item');
            if (firstResult) {
                window.location.href = firstResult.href;
            }
        } else if (e.key === 'Escape') {
            hideSearchResults();
            searchBox.blur();
        }
    });
    
    // Hide results when clicking outside
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.search-section')) {
            hideSearchResults();
        }
    });
    
    // Show results when focusing on search box (if there's content)
    searchBox.addEventListener('focus', function() {
        if (this.value.trim().length >= 2) {
            performSearch(this.value.trim());
        }
    });
}

function performSearch(query) {
    const searchResults = document.getElementById('searchResults');
    
    if (!fuse || !searchIndex) {
        console.error('Search not properly initialized');
        return;
    }
    
    // Perform fuzzy search
    const results = fuse.search(query);
    
    // Display results
    displaySearchResults(results, query);
}

function displaySearchResults(results, query) {
    const searchResults = document.getElementById('searchResults');
    
    if (results.length === 0) {
        searchResults.innerHTML = `
            <div class="no-results">
                No matches found for "${query}"<br>
                <small>Try different keywords or check spelling</small>
            </div>
        `;
        showSearchResults();
        return;
    }
    
    // Limit to top 8 results
    const topResults = results.slice(0, 8);
    
    let html = '';
    
    // Add search hint for first few characters
    if (query.length <= 3) {
        html += `<div class="search-hint">💡 Keep typing for more specific results</div>`;
    }
    
    // Generate result items
    topResults.forEach(result => {
        const item = result.item;
        const score = result.score;
        
        html += `
            <a href="${item.url}" class="search-result-item">
                <div class="result-title">
                    ${item.title}
                    <span class="result-condition ${item.condition}">${item.condition.toUpperCase()}</span>
                </div>
                <div class="result-description">${item.description}</div>
            </a>
        `;
    });
    
    searchResults.innerHTML = html;
    showSearchResults();
}

function showSearchResults() {
    const searchResults = document.getElementById('searchResults');
    searchResults.classList.add('show');
}

function hideSearchResults() {
    const searchResults = document.getElementById('searchResults');
    searchResults.classList.remove('show');
}

// Fallback search function if Fuse.js fails to load
function setupFallbackSearch() {
    const searchBox = document.getElementById('searchBox');
    
    if (!searchBox) return;
    
    searchBox.addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            handleFallbackSearch(event);
        }
    });
}

function handleFallbackSearch(event) {
    const searchTerm = event.target.value.toLowerCase().trim();
    
    // Basic fallback routes for essential pages
    const routes = {
        'autism': 'conditions/autism.html',
        'adhd': 'conditions/adhd.html',
        'bipolar': 'conditions/bipolar.html',
        'bpd': 'conditions/borderline-personality-disorder.html',
        'ocd': 'conditions/ocd.html',
        'task initiation': 'struggles/task-initiation-paralysis.html',
        'paralysis': 'struggles/task-initiation-paralysis.html',
        'attention': 'struggles/attention-regulation.html',
        'memory': 'struggles/working-memory-difficulties.html',
        'social cues': 'struggles/missing-social-cues.html',
        'masking': 'struggles/masking-burnout.html'
    };
    
    // Find matching route
    let targetPage = null;
    for (const [term, page] of Object.entries(routes)) {
        if (searchTerm.includes(term)) {
            targetPage = page;
            break;
        }
    }
    
    if (targetPage) {
        window.location.href = targetPage;
    } else if (searchTerm) {
        // Route to appropriate section
        if (searchTerm.includes('condition') || searchTerm.includes('brain')) {
            window.location.href = 'conditions/index.html';
        } else if (searchTerm.includes('toolkit') || searchTerm.includes('advocacy')) {
            window.location.href = 'toolkits/index.html';
        } else {
            window.location.href = 'struggles/index.html';
        }
    }
}

// Smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});
</script>
