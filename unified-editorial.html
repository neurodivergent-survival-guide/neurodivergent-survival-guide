---
layout: default
title: "Unified Editorial Dashboard"
permalink: /unified-editorial/
---

<style>
.dashboard-container {
    max-width: 1600px;
    margin: 0 auto;
    padding: 2rem;
}

.dashboard-header {
    text-align: center;
    margin-bottom: 2rem;
}

.dashboard-header h1 {
    margin-bottom: 0.5rem;
}

.dashboard-header p {
    color: #666;
    font-size: 1.1rem;
}

.controls {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    text-align: center;
}

.control-row {
    display: flex;
    gap: 1rem;
    justify-content: center;
    align-items: center;
    margin-bottom: 1rem;
    flex-wrap: wrap;
}

.analyze-btn, .expand-btn, .collapse-btn {
    background: #007acc;
    color: white;
    border: none;
    padding: 0.8rem 1.5rem;
    border-radius: 6px;
    font-size: 1rem;
    cursor: pointer;
    font-weight: 500;
}

.analyze-btn:hover {
    background: #005999;
}

.expand-btn {
    background: #28a745;
}

.expand-btn:hover {
    background: #218838;
}

.collapse-btn {
    background: #6c757d;
}

.collapse-btn:hover {
    background: #5a6268;
}

.loading {
    text-align: center;
    padding: 2rem;
    display: none;
    font-size: 1.1rem;
    color: #007acc;
}

.results-container {
    display: none;
}

.article-card {
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.article-header {
    padding: 1rem 1.5rem;
    background: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.article-header:hover {
    background: #e9ecef;
}

.article-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: #2c3e50;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.condition-badge {
    padding: 0.3rem 0.8rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
}

.condition-adhd { background: #ffebee; color: #d63031; }
.condition-autism { background: #d4edda; color: #27ae60; }
.condition-bipolar { background: #e3f2fd; color: #2196f3; }
.condition-bpd { background: #fef9e7; color: #f39c12; }
.condition-ocd { background: #f3e5f5; color: #9c27b0; }

.overall-status {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.status-indicator {
    padding: 0.3rem 0.6rem;
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: 600;
}

.status-optimal { background: #d4edda; color: #27ae60; }
.status-warning { background: #fff3cd; color: #856404; }
.status-needs-work { background: #f8d7da; color: #721c24; }

.article-content {
    padding: 1.5rem;
    display: none;
}

.article-card.expanded .article-content {
    display: block;
}

.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.metric-card {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 6px;
    border: 1px solid #dee2e6;
}

.metric-title {
    font-size: 0.9rem;
    color: #666;
    margin-bottom: 0.5rem;
}

.metric-value {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.3rem;
}

.metric-target {
    font-size: 0.85rem;
    color: #666;
}

.metric-optimal { color: #27ae60; }
.metric-warning { color: #f39c12; }
.metric-error { color: #e74c3c; }

.section-details {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    overflow: hidden;
    margin-top: 1rem;
}

.section-details h4 {
    background: #f8f9fa;
    padding: 0.8rem 1rem;
    margin: 0;
    font-size: 1rem;
    border-bottom: 1px solid #dee2e6;
}

.details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 0;
}

.detail-item {
    padding: 1rem;
    border-right: 1px solid #dee2e6;
    border-bottom: 1px solid #dee2e6;
}

.detail-item:last-child {
    border-right: none;
}

.detail-label {
    font-size: 0.85rem;
    color: #666;
    margin-bottom: 0.3rem;
}

.detail-value {
    font-size: 1.1rem;
    font-weight: 600;
}

.summary-stats {
    background: #007acc;
    color: white;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    display: none;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    text-align: center;
}

.stat-item {
    padding: 0.5rem;
}

.stat-number {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.3rem;
}

.stat-label {
    font-size: 0.9rem;
    opacity: 0.9;
}

.toggle-icon {
    font-size: 1.2rem;
    color: #666;
}

.article-card.expanded .toggle-icon {
    transform: rotate(180deg);
}

.jargon-section {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    padding: 1rem;
    margin-top: 1rem;
}

.jargon-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.8rem;
}

.jargon-title {
    font-weight: 600;
    font-size: 1rem;
}

.jargon-count {
    padding: 0.3rem 0.6rem;
    border-radius: 4px;
    font-size: 0.9rem;
    font-weight: 600;
}

.jargon-optimal { background: #d4edda; color: #27ae60; }
.jargon-warning { background: #fff3cd; color: #856404; }
.jargon-error { background: #f8d7da; color: #721c24; }

.jargon-terms {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.jargon-term {
    background: #6c5ce7;
    color: white;
    padding: 0.3rem 0.8rem;
    border-radius: 12px;
    font-size: 0.85rem;
}

.search-terms-section {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    padding: 1rem;
    margin-top: 1rem;
}

.search-terms-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.8rem;
}

.search-terms-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.search-term {
    background: #007acc;
    color: white;
    padding: 0.3rem 0.8rem;
    border-radius: 12px;
    font-size: 0.85rem;
}

.analyze-single-btn {
    background: #28a745;
    color: white;
    border: none;
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    font-size: 0.9rem;
    cursor: pointer;
    font-weight: 500;
}

.analyze-single-btn:hover {
    background: #218838;
}

.analyze-single-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
}

.reanalyze-btn {
    background: #007acc;
    color: white;
    border: none;
    padding: 0.3rem 0.6rem;
    border-radius: 4px;
    font-size: 1rem;
    cursor: pointer;
    margin-right: 0.5rem;
    font-weight: bold;
}

.reanalyze-btn:hover {
    background: #005999;
}

.reanalyze-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
}

@media (max-width: 768px) {
    .metrics-grid {
        grid-template-columns: 1fr;
    }
    
    .details-grid {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>

<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Unified Editorial Dashboard</h1>
        <p>Complete standards compliance analysis in one place</p>
    </div>

    <div class="controls">
        <div class="control-row">
            <button class="analyze-btn" onclick="analyzeAllArticles()">Analyze All Articles</button>
            <button class="expand-btn" onclick="expandAll()">Expand All</button>
            <button class="collapse-btn" onclick="collapseAll()">Collapse All</button>
        </div>
        
        <div class="loading" id="loading">
            <p>⏳ Analyzing articles... <span id="progress">0</span> of <span id="total">0</span> complete</p>
        </div>
    </div>

    <div class="summary-stats" id="summary-stats">
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number" id="total-articles">0</div>
                <div class="stat-label">Total Articles</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="fully-compliant">0</div>
                <div class="stat-label">Fully Compliant</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="word-count-ok">0</div>
                <div class="stat-label">Word Count OK</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="strategies-ok">0</div>
                <div class="stat-label">Strategies OK</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="jargon-ok">0</div>
                <div class="stat-label">Jargon OK</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="search-terms-ok">0</div>
                <div class="stat-label">Search Terms OK</div>
            </div>
        </div>
    </div>

    <div class="results-container" id="results-container">
        <!-- Results will be populated here -->
    </div>
</div>

<!-- Hidden data for Jekyll to populate -->
<div style="display: none;" id="article-data">
{% for page in site.pages %}
  {% if page.layout == 'struggle' %}
  <div class="article-info"
       data-title="{{ page.title }}" 
       data-url="{{ page.url }}" 
       data-condition="{{ page.condition }}"
       data-search-terms="{{ page.search_terms | join: '|' }}"
       data-status="{{ page.status | default: 'published' }}"></div>
  {% endif %}
{% endfor %}
</div>

<script>
let allResults = [];

// Initialize the article list immediately when script loads
initializeArticleList();

function initializeArticleList() {
    console.log('Initializing article list...');
    const articleElements = document.querySelectorAll('.article-info');
    const container = document.getElementById('results-container');
    
    if (!container) {
        console.error('Results container not found');
        return;
    }
    
    console.log(`Found ${articleElements.length} articles to display`);
    
    // Clear container
    container.innerHTML = '';
    allResults = [];
    
    // Create initial list of articles with "Analyze" buttons
    articleElements.forEach((el, index) => {
        const article = {
            title: el.dataset.title,
            url: el.dataset.url,
            condition: el.dataset.condition,
            searchTerms: el.dataset.searchTerms ? el.dataset.searchTerms.split('|') : [],
            status: el.dataset.status,
            analyzed: false
        };
        
        allResults.push(article);
        
        // Create initial card with just title and analyze button
        const card = document.createElement('div');
        card.className = 'article-card';
        card.id = `article-${index}`;
        
        card.innerHTML = `
            <div class="article-header">
                <div class="article-title">
                    <span>${article.title}</span>
                    <span class="condition-badge condition-${article.condition}">${article.condition}</span>
                </div>
                <div class="overall-status">
                    <button class="analyze-single-btn" onclick="analyzeSingleArticle(${index})" title="Analyze this article">Analyze</button>
                </div>
            </div>
            <div class="article-content" id="content-${index}" style="display: none;">
                <p style="text-align: center; color: #666;">Click "Analyze" to view metrics for this article</p>
            </div>
        `;
        
        container.appendChild(card);
    });
    
    // Update total count
    const totalElement = document.getElementById('total-articles');
    if (totalElement) {
        totalElement.textContent = allResults.length;
    }
    
    console.log('Article list initialized');
}

async function analyzeSingleArticle(index) {
    const article = allResults[index];
    const card = document.getElementById(`article-${index}`);
    const analyzeBtn = card.querySelector('.analyze-single-btn');
    const contentDiv = document.getElementById(`content-${index}`);
    
    // Show loading state
    analyzeBtn.textContent = '⏳ Analyzing...';
    analyzeBtn.disabled = true;
    contentDiv.style.display = 'block';
    contentDiv.innerHTML = '<p style="text-align: center; color: #007acc;">Analyzing article...</p>';
    
    console.log(`Analyzing: ${article.title}`);
    
    try {
        const response = await fetch(article.url);
        const html = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        
        // Count words in each section
        const sections = {
            what: countSectionWords(doc, '.what-section'),
            why: countSectionWords(doc, '.why-section'),
            nextFive: countStrategies(doc, '.immediate-help'),
            longTerm: countStrategies(doc, '.long-term'),
            medical: countSectionWords(doc, '.medical-section'),
            validation: countSectionWords(doc, '.validation-section')
        };
        
        // Extract jargon terms
        let jargonElements = doc.querySelectorAll('a.jargon');
        if (jargonElements.length === 0) {
            jargonElements = doc.querySelectorAll('.jargon');
        }
        
        const uniqueTerms = new Set();
        jargonElements.forEach(element => {
            const clone = element.cloneNode(true);
            const tooltips = clone.querySelectorAll('span');
            tooltips.forEach(tooltip => tooltip.remove());
            
            const jargonText = clone.textContent.trim();
            if (jargonText) {
                const normalizedTerm = jargonText.toLowerCase().replace(/\s+/g, ' ');
                uniqueTerms.add(normalizedTerm);
            }
        });
        
        const uniqueJargonList = Array.from(uniqueTerms).sort();
        const uniqueJargon = uniqueJargonList.length;
        
        // Calculate compliance
        const totalCountedWords = sections.what + sections.why + sections.medical + sections.validation;
        const wordCountOk = totalCountedWords >= 1000 && totalCountedWords <= 1500;
        const strategiesOk = (sections.nextFive >= 5 && sections.nextFive <= 8) && 
                            (sections.longTerm >= 5 && sections.longTerm <= 8);
        const jargonOk = uniqueJargon >= 18 && uniqueJargon <= 25;
        const searchTermsOk = article.searchTerms.length >= 6 && article.searchTerms.length <= 8;
        
        const whatOk = sections.what >= 300 && sections.what <= 400;
        const whyOk = sections.why >= 200 && sections.why <= 300;
        const medicalOk = sections.medical >= 200 && sections.medical <= 300;
        const validationOk = sections.validation >= 200 && sections.validation <= 400;
        
        const fullyCompliant = wordCountOk && strategiesOk && jargonOk && searchTermsOk;
        
        // Update article data
        allResults[index] = {
            ...article,
            analyzed: true,
            sections,
            totalCountedWords,
            uniqueJargon,
            uniqueJargonList,
            wordCountOk,
            strategiesOk,
            jargonOk,
            searchTermsOk,
            whatOk,
            whyOk,
            medicalOk,
            validationOk,
            fullyCompliant
        };
        
        // Update the card with full analysis
        renderSingleArticle(index);
        updateSummaryStats();
        
        console.log(`Analysis complete: ${article.title}`);
        
    } catch (error) {
        console.error(`Error analyzing ${article.title}:`, error);
        contentDiv.innerHTML = '<p style="text-align: center; color: #e74c3c;">Error analyzing article. Please try again.</p>';
        analyzeBtn.textContent = 'Retry';
        analyzeBtn.disabled = false;
    }
}

function renderSingleArticle(index) {
    const article = allResults[index];
    const card = document.getElementById(`article-${index}`);
    
    // Determine overall status
    let overallStatus = 'needs-work';
    let statusText = 'Needs Work';
    if (article.fullyCompliant) {
        overallStatus = 'optimal';
        statusText = 'Fully Compliant';
    } else if ((article.wordCountOk ? 1 : 0) + (article.strategiesOk ? 1 : 0) + 
               (article.jargonOk ? 1 : 0) + (article.searchTermsOk ? 1 : 0) >= 2) {
        overallStatus = 'warning';
        statusText = 'Partially Compliant';
    }
    
    card.innerHTML = `
        <div class="article-header" onclick="toggleArticle(${index})">
            <div class="article-title">
                <span>${article.title}</span>
                <span class="condition-badge condition-${article.condition}">${article.condition}</span>
            </div>
            <div class="overall-status">
                <button class="reanalyze-btn" onclick="event.stopPropagation(); analyzeSingleArticle(${index})" title="Re-analyze this article">↻</button>
                <span class="status-indicator status-${overallStatus}">${statusText}</span>
                <span class="toggle-icon">▼</span>
            </div>
        </div>
        <div class="article-content">
            <div class="section-details">
                <h4>Word Count Breakdown by Section</h4>
                <div class="details-grid">
                    <div class="detail-item">
                        <div class="detail-label">Total Counted Words</div>
                        <div class="detail-value ${article.wordCountOk ? 'metric-optimal' : 'metric-error'}">
                            ${article.totalCountedWords}
                        </div>
                        <div class="metric-target">Target: 1,000-1,500</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">What This Feels Like</div>
                        <div class="detail-value ${article.whatOk ? 'metric-optimal' : article.sections.what < 300 ? 'metric-warning' : 'metric-error'}">
                            ${article.sections.what}
                        </div>
                        <div class="metric-target">Target: 300-400</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Why This Happens</div>
                        <div class="detail-value ${article.whyOk ? 'metric-optimal' : article.sections.why < 200 ? 'metric-warning' : 'metric-error'}">
                            ${article.sections.why}
                        </div>
                        <div class="metric-target">Target: 200-300</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Medical Intervention</div>
                        <div class="detail-value ${article.medicalOk ? 'metric-optimal' : article.sections.medical < 200 ? 'metric-warning' : 'metric-error'}">
                            ${article.sections.medical}
                        </div>
                        <div class="metric-target">Target: 200-300</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Validation</div>
                        <div class="detail-value ${article.validationOk ? 'metric-optimal' : article.sections.validation < 200 ? 'metric-warning' : 'metric-error'}">
                            ${article.sections.validation}
                        </div>
                        <div class="metric-target">Target: 200-400</div>
                    </div>
                </div>
            </div>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-title">Unique Jargon Terms</div>
                    <div class="metric-value ${article.jargonOk ? 'metric-optimal' : article.uniqueJargon < 18 ? 'metric-warning' : 'metric-error'}">
                        ${article.uniqueJargon}
                    </div>
                    <div class="metric-target">Target: 18-25</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Search Terms</div>
                    <div class="metric-value ${article.searchTermsOk ? 'metric-optimal' : 'metric-warning'}">
                        ${article.searchTerms.length}
                    </div>
                    <div class="metric-target">Target: 6-8</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Next 5 Minutes Strategies</div>
                    <div class="metric-value ${article.sections.nextFive >= 5 && article.sections.nextFive <= 8 ? 'metric-optimal' : 'metric-warning'}">
                        ${article.sections.nextFive}
                    </div>
                    <div class="metric-target">Target: 5-8</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Long-term Strategies</div>
                    <div class="metric-value ${article.sections.longTerm >= 5 && article.sections.longTerm <= 8 ? 'metric-optimal' : 'metric-warning'}">
                        ${article.sections.longTerm}
                    </div>
                    <div class="metric-target">Target: 5-8</div>
                </div>
            </div>
            
            <div class="jargon-section">
                <div class="jargon-header">
                    <span class="jargon-title">Unique Jargon Terms</span>
                    <span class="jargon-count ${article.jargonOk ? 'jargon-optimal' : article.uniqueJargon < 18 ? 'jargon-warning' : 'jargon-error'}">
                        ${article.uniqueJargon} terms (Target: 18-25)
                    </span>
                </div>
                <div class="jargon-terms" style="line-height: 1.6;">
                    ${article.uniqueJargonList && article.uniqueJargonList.length > 0 
                        ? article.uniqueJargonList.join(', ')
                        : '<span style="color: #999;">Unable to extract jargon terms</span>'}
                </div>
            </div>
            
            <div class="search-terms-section">
                <div class="search-terms-header">
                    <span class="jargon-title">Search Terms</span>
                    <span class="jargon-count ${article.searchTermsOk ? 'jargon-optimal' : 'jargon-warning'}">
                        ${article.searchTerms.length} terms (Target: 6-8)
                    </span>
                </div>
                <div class="search-terms-list" style="line-height: 1.6;">
                    ${article.searchTerms && article.searchTerms.length > 0 
                        ? '"' + article.searchTerms.join('", "') + '"'
                        : '<span style="color: #999;">No search terms defined</span>'}
                </div>
            </div>
            
            <div class="links">
                <a href="${article.url}" target="_blank">View Page</a>
                <a href="https://github.com/neurodivergent-survival-guide/neurodivergent-survival-guide/edit/main/struggles/${article.url.split('/').pop()}" target="_blank">Edit on GitHub</a>
            </div>
        </div>
    `;
    
    // Keep expanded if it was expanded
    card.classList.add('expanded');
}

async function analyzeAllArticles() {
    // DEBUG: Log start
    console.log('=== Starting analysis ===');
    
    const button = document.querySelector('.analyze-btn');
    const loading = document.getElementById('loading');
    const resultsContainer = document.getElementById('results-container');
    const summaryStats = document.getElementById('summary-stats');
    
    button.disabled = true;
    button.textContent = 'Analyzing...';
    loading.style.display = 'block';
    resultsContainer.style.display = 'none';
    summaryStats.style.display = 'none';
    
    const articleElements = document.querySelectorAll('.article-info');
    console.log(`DEBUG: Found ${articleElements.length} articles to analyze`);
    
    const articles = Array.from(articleElements).map(el => ({
        title: el.dataset.title,
        url: el.dataset.url,
        condition: el.dataset.condition,
        searchTerms: el.dataset.searchTerms ? el.dataset.searchTerms.split('|') : [],
        status: el.dataset.status
    }));
    
    document.getElementById('total').textContent = articles.length;
    allResults = [];
    
    for (let i = 0; i < articles.length; i++) {
        const article = articles[i];
        document.getElementById('progress').textContent = i + 1;
        
        // DEBUG: Log each article being fetched
        console.log(`\nDEBUG: Fetching article ${i+1}/${articles.length}: ${article.title}`);
        console.log(`  URL: ${article.url}`);
        
        try {
            const response = await fetch(article.url);
            const html = await response.text();
            
            // DEBUG: Log response details
            console.log(`  Response status: ${response.status}, HTML length: ${html.length}`);
            
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // DEBUG: Check what's in the parsed document
            const hasBody = doc.body !== null;
            const hasContentCard = html.includes('content-card');
            console.log(`  Has body: ${hasBody}, Has content-card: ${hasContentCard}`);
            
            // Count words in each section
            const sections = {
                what: countSectionWords(doc, '.what-section'),
                why: countSectionWords(doc, '.why-section'),
                nextFive: countStrategies(doc, '.immediate-help'),
                longTerm: countStrategies(doc, '.long-term'),
                medical: countSectionWords(doc, '.medical-section'),
                validation: countSectionWords(doc, '.validation-section')
            };
            
            // DEBUG: Log section counts
            console.log(`  Sections - What: ${sections.what}, Why: ${sections.why}, Medical: ${sections.medical}, Validation: ${sections.validation}`);
            console.log(`  Strategies - Next 5: ${sections.nextFive}, Long-term: ${sections.longTerm}`);
            
            // Extract jargon terms - try multiple selectors
            let jargonElements = doc.querySelectorAll('a.jargon');
            console.log(`  Found ${jargonElements.length} a.jargon elements`);
            
            if (jargonElements.length === 0) {
                jargonElements = doc.querySelectorAll('.jargon');
                console.log(`  Found ${jargonElements.length} .jargon elements`);
            }
            
            if (jargonElements.length === 0) {
                jargonElements = doc.querySelectorAll('[class="jargon"]');
                console.log(`  Found ${jargonElements.length} [class="jargon"] elements`);
            }
            
            // DEBUG: If still no jargon, check raw HTML
            if (jargonElements.length === 0) {
                const jargonCount = (html.match(/class="jargon"/g) || []).length;
                console.log(`  Raw HTML contains ${jargonCount} instances of class="jargon"`);
                
                // Show a sample of the HTML to see what we're getting
                if (jargonCount > 0) {
                    const jargonIndex = html.indexOf('class="jargon"');
                    if (jargonIndex > -1) {
                        const sample = html.substring(Math.max(0, jargonIndex - 50), Math.min(html.length, jargonIndex + 200));
                        console.log(`  Sample around jargon: ...${sample}...`);
                    }
                }
            }
            
            const uniqueTerms = new Set();
            
            jargonElements.forEach((element, index) => {
                const clone = element.cloneNode(true);
                // Remove all nested spans (tooltips)
                const tooltips = clone.querySelectorAll('span');
                tooltips.forEach(tooltip => tooltip.remove());
                
                const jargonText = clone.textContent.trim();
                if (jargonText) {
                    const normalizedTerm = jargonText.toLowerCase().replace(/\s+/g, ' ');
                    uniqueTerms.add(normalizedTerm);
                    
                    // DEBUG: Log first few terms
                    if (index < 3) {
                        console.log(`    Term ${index + 1}: "${jargonText}"`);
                    }
                }
            });
            
            const uniqueJargonList = Array.from(uniqueTerms).sort();
            const uniqueJargon = uniqueJargonList.length;
            
            console.log(`  FINAL: ${uniqueJargon} unique jargon terms extracted`);
            if (uniqueJargon > 0 && uniqueJargon <= 5) {
                console.log(`  Terms: ${uniqueJargonList.join(', ')}`);
            }
            
            // Calculate totals and compliance
            const totalCountedWords = sections.what + sections.why + sections.medical + sections.validation;
            const wordCountOk = totalCountedWords >= 1000 && totalCountedWords <= 1500;
            const strategiesOk = (sections.nextFive >= 5 && sections.nextFive <= 8) && 
                                (sections.longTerm >= 5 && sections.longTerm <= 8);
            const jargonOk = uniqueJargon >= 18 && uniqueJargon <= 25;
            const searchTermsOk = article.searchTerms.length >= 6 && article.searchTerms.length <= 8;
            
            // Check individual section compliance
            const whatOk = sections.what >= 300 && sections.what <= 400;
            const whyOk = sections.why >= 200 && sections.why <= 300;
            const medicalOk = sections.medical >= 200 && sections.medical <= 300;
            const validationOk = sections.validation >= 200 && sections.validation <= 400;
            
            const fullyCompliant = wordCountOk && strategiesOk && jargonOk && searchTermsOk;
            
            allResults.push({
                ...article,
                sections,
                totalCountedWords,
                uniqueJargon,
                uniqueJargonList,
                wordCountOk,
                strategiesOk,
                jargonOk,
                searchTermsOk,
                whatOk,
                whyOk,
                medicalOk,
                validationOk,
                fullyCompliant
            });
            
        } catch (error) {
            console.error(`ERROR analyzing ${article.title}:`, error);
            allResults.push({
                ...article,
                error: true,
                sections: { what: 0, why: 0, nextFive: 0, longTerm: 0, medical: 0, validation: 0 },
                totalCountedWords: 0,
                uniqueJargon: 0,
                uniqueJargonList: [],
                wordCountOk: false,
                strategiesOk: false,
                jargonOk: false,
                searchTermsOk: false,
                whatOk: false,
                whyOk: false,
                medicalOk: false,
                validationOk: false,
                fullyCompliant: false
            });
        }
    }
    
    console.log('\n=== Analysis complete ===');
    console.log(`Total articles analyzed: ${allResults.length}`);
    console.log(`Articles with jargon: ${allResults.filter(a => a.uniqueJargon > 0).length}`);
    
    // Sort by least compliant first (most issues)
    allResults.sort((a, b) => {
        const aScore = (a.wordCountOk ? 1 : 0) + (a.strategiesOk ? 1 : 0) + 
                      (a.jargonOk ? 1 : 0) + (a.searchTermsOk ? 1 : 0);
        const bScore = (b.wordCountOk ? 1 : 0) + (b.strategiesOk ? 1 : 0) + 
                      (b.jargonOk ? 1 : 0) + (b.searchTermsOk ? 1 : 0);
        return aScore - bScore;
    });
    
    renderResults();
    updateSummaryStats();
    
    loading.style.display = 'none';
    resultsContainer.style.display = 'block';
    summaryStats.style.display = 'block';
    button.disabled = false;
    button.textContent = 'Re-analyze All Articles';
}

function countSectionWords(doc, selector) {
    const section = doc.querySelector(selector);
    if (!section) return 0;
    
    const clone = section.cloneNode(true);
    // Remove tooltips and learn more sections from word count
    const tooltips = clone.querySelectorAll('.tooltip');
    tooltips.forEach(tooltip => tooltip.remove());
    const learnMoreSections = clone.querySelectorAll('.learn-more');
    learnMoreSections.forEach(learnMore => learnMore.remove());
    
    const text = clone.textContent || clone.innerText || '';
    const words = text.trim().split(/\s+/).filter(word => word.length > 0);
    return words.length;
}

function countStrategies(doc, selector) {
    const section = doc.querySelector(selector);
    if (!section) return 0;
    
    const listItems = section.querySelectorAll('li');
    return listItems.length;
}

function renderResults() {
    const container = document.getElementById('results-container');
    container.innerHTML = '';
    
    allResults.forEach((article, index) => {
        const card = document.createElement('div');
        card.className = 'article-card';
        card.id = `article-${index}`;
        
        // Determine overall status
        let overallStatus = 'needs-work';
        let statusText = 'Needs Work';
        if (article.fullyCompliant) {
            overallStatus = 'optimal';
            statusText = 'Fully Compliant';
        } else if ((article.wordCountOk ? 1 : 0) + (article.strategiesOk ? 1 : 0) + 
                   (article.jargonOk ? 1 : 0) + (article.searchTermsOk ? 1 : 0) >= 2) {
            overallStatus = 'warning';
            statusText = 'Partially Compliant';
        }
        
        card.innerHTML = `
            <div class="article-header" onclick="toggleArticle(${index})">
                <div class="article-title">
                    <span>${article.title}</span>
                    <span class="condition-badge condition-${article.condition}">${article.condition}</span>
                </div>
                <div class="overall-status">
                    <span class="status-indicator status-${overallStatus}">${statusText}</span>
                    <span class="toggle-icon">▼</span>
                </div>
            </div>
            <div class="article-content">
                <div class="section-details">
                    <h4>Word Count Breakdown by Section</h4>
                    <div class="details-grid">
                        <div class="detail-item">
                            <div class="detail-label">Total Counted Words</div>
                            <div class="detail-value ${article.wordCountOk ? 'metric-optimal' : 'metric-error'}">
                                ${article.totalCountedWords}
                            </div>
                            <div class="metric-target">Target: 1,000-1,500</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">What This Feels Like</div>
                            <div class="detail-value ${article.whatOk ? 'metric-optimal' : article.sections.what < 300 ? 'metric-warning' : 'metric-error'}">
                                ${article.sections.what}
                            </div>
                            <div class="metric-target">Target: 300-400</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Why This Happens</div>
                            <div class="detail-value ${article.whyOk ? 'metric-optimal' : article.sections.why < 200 ? 'metric-warning' : 'metric-error'}">
                                ${article.sections.why}
                            </div>
                            <div class="metric-target">Target: 200-300</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Medical Intervention</div>
                            <div class="detail-value ${article.medicalOk ? 'metric-optimal' : article.sections.medical < 200 ? 'metric-warning' : 'metric-error'}">
                                ${article.sections.medical}
                            </div>
                            <div class="metric-target">Target: 200-300</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Validation</div>
                            <div class="detail-value ${article.validationOk ? 'metric-optimal' : article.sections.validation < 200 ? 'metric-warning' : 'metric-error'}">
                                ${article.sections.validation}
                            </div>
                            <div class="metric-target">Target: 200-400</div>
                        </div>
                    </div>
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-title">Unique Jargon Terms</div>
                        <div class="metric-value ${article.jargonOk ? 'metric-optimal' : article.uniqueJargon < 18 ? 'metric-warning' : 'metric-error'}">
                            ${article.uniqueJargon}
                        </div>
                        <div class="metric-target">Target: 18-25</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-title">Search Terms</div>
                        <div class="metric-value ${article.searchTermsOk ? 'metric-optimal' : 'metric-warning'}">
                            ${article.searchTerms.length}
                        </div>
                        <div class="metric-target">Target: 6-8</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-title">Next 5 Minutes Strategies</div>
                        <div class="metric-value ${article.sections.nextFive >= 5 && article.sections.nextFive <= 8 ? 'metric-optimal' : 'metric-warning'}">
                            ${article.sections.nextFive}
                        </div>
                        <div class="metric-target">Target: 5-8</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-title">Long-term Strategies</div>
                        <div class="metric-value ${article.sections.longTerm >= 5 && article.sections.longTerm <= 8 ? 'metric-optimal' : 'metric-warning'}">
                            ${article.sections.longTerm}
                        </div>
                        <div class="metric-target">Target: 5-8</div>
                    </div>
                </div>
                
                <div class="jargon-section">
                    <div class="jargon-header">
                        <span class="jargon-title">Unique Jargon Terms</span>
                        <span class="jargon-count ${article.jargonOk ? 'jargon-optimal' : article.uniqueJargon < 18 ? 'jargon-warning' : 'jargon-error'}">
                            ${article.uniqueJargon} terms (Target: 18-25)
                        </span>
                    </div>
                    <div class="jargon-terms" style="line-height: 1.6;">
                        ${article.uniqueJargonList && article.uniqueJargonList.length > 0 
                            ? article.uniqueJargonList.join(', ')
                            : '<span style="color: #999;">Unable to extract jargon terms - check console for debug info</span>'}
                    </div>
                </div>
                
                <div class="search-terms-section">
                    <div class="search-terms-header">
                        <span class="jargon-title">Search Terms</span>
                        <span class="jargon-count ${article.searchTermsOk ? 'jargon-optimal' : 'jargon-warning'}">
                            ${article.searchTerms.length} terms (Target: 6-8)
                        </span>
                    </div>
                    <div class="search-terms-list" style="line-height: 1.6;">
                        ${article.searchTerms && article.searchTerms.length > 0 
                            ? '"' + article.searchTerms.join('", "') + '"'
                            : '<span style="color: #999;">No search terms defined</span>'}
                    </div>
                </div>
                
                <div class="links">
                    <a href="${article.url}" target="_blank">View Page</a>
                    <a href="https://github.com/neurodivergent-survival-guide/neurodivergent-survival-guide/edit/main/struggles/${article.url.split('/').pop()}" target="_blank">Edit on GitHub</a>
                </div>
            </div>
        `;
        
        container.appendChild(card);
    });
}

function updateSummaryStats() {
    const totalArticles = allResults.length;
    const fullyCompliant = allResults.filter(a => a.fullyCompliant).length;
    const wordCountOk = allResults.filter(a => a.wordCountOk).length;
    const strategiesOk = allResults.filter(a => a.strategiesOk).length;
    const jargonOk = allResults.filter(a => a.jargonOk).length;
    const searchTermsOk = allResults.filter(a => a.searchTermsOk).length;
    
    document.getElementById('total-articles').textContent = totalArticles;
    document.getElementById('fully-compliant').textContent = fullyCompliant;
    document.getElementById('word-count-ok').textContent = wordCountOk;
    document.getElementById('strategies-ok').textContent = strategiesOk;
    document.getElementById('jargon-ok').textContent = jargonOk;
    document.getElementById('search-terms-ok').textContent = searchTermsOk;
}

function toggleArticle(index) {
    const card = document.getElementById(`article-${index}`);
    card.classList.toggle('expanded');
}

function expandAll() {
    document.querySelectorAll('.article-card').forEach(card => {
        card.classList.add('expanded');
    });
}

function collapseAll() {
    document.querySelectorAll('.article-card').forEach(card => {
        card.classList.remove('expanded');
    });
}

async function reanalyzeArticle(index) {
    const article = allResults[index];
    console.log(`Re-analyzing: ${article.title}`);
    
    // Change button to show loading
    const card = document.getElementById(`article-${index}`);
    const reanalyzeBtn = card.querySelector('.reanalyze-btn');
    const originalText = reanalyzeBtn.textContent;
    reanalyzeBtn.textContent = '⏳';
    reanalyzeBtn.disabled = true;
    
    try {
        const response = await fetch(article.url);
        const html = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        
        // Count words in each section
        const sections = {
            what: countSectionWords(doc, '.what-section'),
            why: countSectionWords(doc, '.why-section'),
            nextFive: countStrategies(doc, '.immediate-help'),
            longTerm: countStrategies(doc, '.long-term'),
            medical: countSectionWords(doc, '.medical-section'),
            validation: countSectionWords(doc, '.validation-section')
        };
        
        // Extract jargon terms
        let jargonElements = doc.querySelectorAll('a.jargon');
        if (jargonElements.length === 0) {
            jargonElements = doc.querySelectorAll('.jargon');
        }
        
        const uniqueTerms = new Set();
        jargonElements.forEach(element => {
            const clone = element.cloneNode(true);
            const tooltips = clone.querySelectorAll('span');
            tooltips.forEach(tooltip => tooltip.remove());
            
            const jargonText = clone.textContent.trim();
            if (jargonText) {
                const normalizedTerm = jargonText.toLowerCase().replace(/\s+/g, ' ');
                uniqueTerms.add(normalizedTerm);
            }
        });
        
        const uniqueJargonList = Array.from(uniqueTerms).sort();
        const uniqueJargon = uniqueJargonList.length;
        
        // Calculate compliance
        const totalCountedWords = sections.what + sections.why + sections.medical + sections.validation;
        const wordCountOk = totalCountedWords >= 1000 && totalCountedWords <= 1500;
        const strategiesOk = (sections.nextFive >= 5 && sections.nextFive <= 8) && 
                            (sections.longTerm >= 5 && sections.longTerm <= 8);
        const jargonOk = uniqueJargon >= 18 && uniqueJargon <= 25;
        const searchTermsOk = article.searchTerms.length >= 6 && article.searchTerms.length <= 8;
        
        const whatOk = sections.what >= 300 && sections.what <= 400;
        const whyOk = sections.why >= 200 && sections.why <= 300;
        const medicalOk = sections.medical >= 200 && sections.medical <= 300;
        const validationOk = sections.validation >= 200 && sections.validation <= 400;
        
        const fullyCompliant = wordCountOk && strategiesOk && jargonOk && searchTermsOk;
        
        // Update the article in allResults
        allResults[index] = {
            ...article,
            sections,
            totalCountedWords,
            uniqueJargon,
            uniqueJargonList,
            wordCountOk,
            strategiesOk,
            jargonOk,
            searchTermsOk,
            whatOk,
            whyOk,
            medicalOk,
            validationOk,
            fullyCompliant
        };
        
        console.log(`Re-analysis complete: ${article.title}`);
        console.log(`  Word count: ${totalCountedWords} (${wordCountOk ? 'OK' : 'NEEDS WORK'})`);
        console.log(`  Jargon terms: ${uniqueJargon} (${jargonOk ? 'OK' : 'NEEDS WORK'})`);
        
        // Re-render and update stats
        renderResults();
        updateSummaryStats();
        
        // Keep the card expanded if it was expanded
        if (card.classList.contains('expanded')) {
            const newCard = document.getElementById(`article-${index}`);
            newCard.classList.add('expanded');
        }
        
    } catch (error) {
        console.error(`Error re-analyzing ${article.title}:`, error);
        reanalyzeBtn.textContent = '⚠';
        setTimeout(() => {
            reanalyzeBtn.textContent = originalText;
            reanalyzeBtn.disabled = false;
        }, 2000);
    }
}
</script>
