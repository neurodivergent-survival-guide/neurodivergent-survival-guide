<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editorial Review Tools</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .tool-section {
            margin-bottom: 40px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
        }
        .tool-section h2 {
            color: #34495e;
            margin-top: 0;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .file-input {
            margin-bottom: 15px;
        }
        .file-input input[type="file"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
        }
        .btn {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        .btn:hover {
            background-color: #2980b9;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        .page-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 15px 0;
            padding: 15px;
            background-color: #fafafa;
        }
        .page-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        .page-link {
            color: #3498db;
            text-decoration: none;
            font-size: 14px;
        }
        .page-link:hover {
            text-decoration: underline;
        }
        .search-terms {
            margin: 10px 0;
        }
        .search-term {
            background-color: #3498db;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin: 2px;
            display: inline-block;
        }
        .tooltip-count {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .tooltip-optimal {
            color: #27ae60;
            font-weight: bold;
        }
        .tooltip-warning {
            color: #f39c12;
            font-weight: bold;
        }
        .tooltip-error {
            color: #e74c3c;
            font-weight: bold;
        }
        .related-links {
            margin-top: 10px;
        }
        .related-link {
            background-color: #95a5a6;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 11px;
            margin: 2px;
            display: inline-block;
        }
        .link-valid {
            background-color: #27ae60;
        }
        .link-invalid {
            background-color: #e74c3c;
        }
        .link-count-good {
            color: #27ae60;
        }
        .link-count-bad {
            color: #e74c3c;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Editorial Review Tools</h1>
        
        <!-- Search Terms Overview -->
        <div class="tool-section">
            <h2>üîç Search Terms Overview</h2>
            <p>View all search terms across pages for review. One-time audit tool.</p>
            <div class="file-input">
                <input type="file" id="searchOverviewFiles" multiple accept=".md,.html" />
            </div>
            <button class="btn" onclick="generateSearchOverview()">Generate Search Terms Overview</button>
            <div id="searchOverviewResults" class="results" style="display: none;"></div>
        </div>

        <!-- Jargon Tooltip Counter -->
        <div class="tool-section">
            <h2>üí¨ Jargon Tooltip Counter</h2>
            <p>Quick count of jargon tooltips per page (target: 18-25 range, but varies).</p>
            <div class="file-input">
                <input type="file" id="jargonFiles" multiple accept=".md,.html" />
            </div>
            <button class="btn" onclick="countJargonTooltips()">Count Jargon Tooltips</button>
            <div id="jargonResults" class="results" style="display: none;"></div>
        </div>

        <!-- Related Struggles Checker -->
        <div class="tool-section">
            <h2>üîó Related Struggles Checker</h2>
            <p>Verify exactly 4-5 related struggle links and check if they point to real pages.</p>
            <div class="file-input">
                <input type="file" id="relatedFiles" multiple accept=".md,.html" />
            </div>
            <button class="btn" onclick="checkRelatedStruggles()">Check Related Links</button>
            <div id="relatedResults" class="results" style="display: none;"></div>
        </div>

        <!-- Cross-Reference Validator -->
        <div class="tool-section">
            <h2>üìã Cross-Reference Validator</h2>
            <p>Upload ALL your struggle pages to check that related links point to actual existing files.</p>
            <div class="file-input">
                <input type="file" id="crossRefFiles" multiple accept=".md,.html" />
            </div>
            <button class="btn" onclick="validateCrossReferences()">Validate Cross-References</button>
            <div id="crossRefResults" class="results" style="display: none;"></div>
        </div>
    </div>

    <script>
        async function generateSearchOverview() {
            const files = document.getElementById('searchOverviewFiles').files;
            if (files.length === 0) {
                alert('Please select files to review.');
                return;
            }

            const results = document.getElementById('searchOverviewResults');
            results.innerHTML = '<h3>Search Terms Overview</h3>';
            results.style.display = 'block';

            let pageData = [];

            for (let file of files) {
                const content = await readFile(file);
                const frontMatter = extractFrontMatter(content);
                
                if (frontMatter && frontMatter.search_terms) {
                    // Generate GitHub link (assumes standard repo structure)
                    const githubLink = `https://github.com/your-repo/blob/main/struggles/${file.name}`;
                    
                    pageData.push({
                        filename: file.name,
                        title: frontMatter.title || file.name,
                        searchTerms: frontMatter.search_terms,
                        githubLink: githubLink
                    });
                }
            }

            let overviewHTML = '';
            pageData.forEach(page => {
                overviewHTML += `
                    <div class="page-card">
                        <div class="page-title">${page.title}</div>
                        <a href="${page.githubLink}" class="page-link" target="_blank">View on GitHub: ${page.filename}</a>
                        <div class="search-terms">
                            <strong>Search Terms:</strong><br>
                            ${page.searchTerms.map(term => `<span class="search-term">${term}</span>`).join(' ')}
                        </div>
                    </div>
                `;
            });

            results.innerHTML += overviewHTML;
        }

        async function countJargonTooltips() {
            const files = document.getElementById('jargonFiles').files;
            if (files.length === 0) {
                alert('Please select files to analyze.');
                return;
            }

            const results = document.getElementById('jargonResults');
            results.innerHTML = '<h3>Jargon Tooltip Counts</h3>';
            results.style.display = 'block';

            let tooltipData = [];

            for (let file of files) {
                const content = await readFile(file);
                const frontMatter = extractFrontMatter(content);
                
                // Count jargon tooltips
                const jargonMatches = content.match(/<span class="jargon">/g) || [];
                const tooltipCount = jargonMatches.length;
                
                const githubLink = `https://github.com/your-repo/blob/main/struggles/${file.name}`;

                tooltipData.push({
                    filename: file.name,
                    title: frontMatter?.title || file.name,
                    count: tooltipCount,
                    githubLink: githubLink
                });
            }

            let tableHTML = `
                <table>
                    <tr>
                        <th>Page</th>
                        <th>Tooltip Count</th>
                        <th>GitHub Link</th>
                    </tr>
            `;

            tooltipData.forEach(data => {
                let countClass = 'tooltip-optimal';
                let statusText = data.count;
                
                if (data.count < 18) {
                    countClass = 'tooltip-warning';
                    statusText += ' (low)';
                } else if (data.count > 25) {
                    countClass = 'tooltip-error';
                    statusText += ' (high)';
                }
                
                tableHTML += `
                    <tr>
                        <td>${data.title}</td>
                        <td class="${countClass}">${statusText}</td>
                        <td><a href="${data.githubLink}" target="_blank" class="page-link">${data.filename}</a></td>
                    </tr>
                `;
            });

            tableHTML += '</table>';
            results.innerHTML += tableHTML;
        }

        async function checkRelatedStruggles() {
            const files = document.getElementById('relatedFiles').files;
            if (files.length === 0) {
                alert('Please select files to check.');
                return;
            }

            const results = document.getElementById('relatedResults');
            results.innerHTML = '<h3>Related Struggles Check</h3>';
            results.style.display = 'block';

            let linkData = [];

            for (let file of files) {
                const content = await readFile(file);
                const frontMatter = extractFrontMatter(content);
                
                // Extract related struggle links
                const linkPattern = /<a href="([^"]*)" class="struggle-tag">([^<]*)<\/a>/g;
                const links = [];
                let match;
                
                while ((match = linkPattern.exec(content)) !== null) {
                    links.push({
                        href: match[1],
                        text: match[2]
                    });
                }
                
                const githubLink = `https://github.com/your-repo/blob/main/struggles/${file.name}`;

                linkData.push({
                    filename: file.name,
                    title: frontMatter?.title || file.name,
                    linkCount: links.length,
                    links: links,
                    githubLink: githubLink
                });
            }

            let pageHTML = '';
            linkData.forEach(page => {
                const countClass = page.linkCount >= 4 && page.linkCount <= 5 ? 'link-count-good' : 'link-count-bad';
                
                pageHTML += `
                    <div class="page-card">
                        <div class="page-title">${page.title}</div>
                        <a href="${page.githubLink}" class="page-link" target="_blank">View on GitHub: ${page.filename}</a>
                        <div class="related-links">
                            <strong>Related Links (<span class="${countClass}">${page.linkCount}</span>, target: 4-5):</strong><br>
                            ${page.links.map(link => 
                                `<span class="related-link">${link.text}</span>`
                            ).join(' ')}
                        </div>
                    </div>
                `;
            });

            results.innerHTML += pageHTML;
        }

        async function validateCrossReferences() {
            const files = document.getElementById('crossRefFiles').files;
            if (files.length === 0) {
                alert('Please select ALL struggle files to validate cross-references.');
                return;
            }

            const results = document.getElementById('crossRefResults');
            results.innerHTML = '<h3>Cross-Reference Validation</h3>';
            results.style.display = 'block';

            // Build index of all available pages
            const availablePages = new Set();
            const pageData = new Map();

            for (let file of files) {
                const content = await readFile(file);
                const frontMatter = extractFrontMatter(content);
                
                availablePages.add(file.name);
                
                // Extract slug or use filename
                const slug = frontMatter?.slug || file.name.replace(/\.(md|html)$/, '');
                availablePages.add(slug);
                availablePages.add(slug + '.html');
                availablePages.add(slug + '.md');
                
                // Extract related struggle links
                const linkPattern = /<a href="([^"]*)" class="struggle-tag">([^<]*)<\/a>/g;
                const links = [];
                let match;
                
                while ((match = linkPattern.exec(content)) !== null) {
                    links.push({
                        href: match[1],
                        text: match[2]
                    });
                }
                
                pageData.set(file.name, {
                    title: frontMatter?.title || file.name,
                    links: links
                });
            }

            // Check each page's links
            let validationHTML = '';
            let totalLinks = 0;
            let brokenLinks = 0;

            pageData.forEach((data, filename) => {
                const githubLink = `https://github.com/your-repo/blob/main/struggles/${filename}`;
                let linkValidation = [];

                data.links.forEach(link => {
                    totalLinks++;
                    // Extract filename from href (handles relative paths)
                    const hrefFile = link.href.split('/').pop();
                    const isValid = availablePages.has(hrefFile) || availablePages.has(link.href);
                    
                    if (!isValid) {
                        brokenLinks++;
                    }
                    
                    linkValidation.push({
                        text: link.text,
                        href: link.href,
                        valid: isValid
                    });
                });

                validationHTML += `
                    <div class="page-card">
                        <div class="page-title">${data.title}</div>
                        <a href="${githubLink}" class="page-link" target="_blank">View on GitHub: ${filename}</a>
                        <div class="related-links">
                            <strong>Link Validation:</strong><br>
                            ${linkValidation.map(link => 
                                `<span class="related-link ${link.valid ? 'link-valid' : 'link-invalid'}">${link.text} ${link.valid ? '‚úì' : '‚úó'}</span>`
                            ).join(' ')}
                            ${linkValidation.length === 0 ? '<em>No related links found</em>' : ''}
                        </div>
                    </div>
                `;
            });

            results.innerHTML += `
                <div style="margin-bottom: 20px; padding: 10px; background-color: ${brokenLinks === 0 ? '#d4edda' : '#f8d7da'}; border-radius: 5px;">
                    <strong>Summary:</strong> ${totalLinks - brokenLinks}/${totalLinks} links valid
                    ${brokenLinks > 0 ? `<br><strong style="color: #721c24;">${brokenLinks} broken links found</strong>` : ''}
                </div>
                ${validationHTML}
            `;
        }

        // Utility functions
        function readFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsText(file);
            });
        }

        function extractFrontMatter(content) {
            const frontMatterMatch = content.match(/^---\s*\n([\s\S]*?)\n---/);
            if (!frontMatterMatch) return null;
            
            try {
                const yamlContent = frontMatterMatch[1];
                const frontMatter = {};
                
                const lines = yamlContent.split('\n');
                let inTags = false;
                
                for (let line of lines) {
                    line = line.trim();
                    if (!line || line.startsWith('#')) continue;
                    
                    if (line === 'tags:') {
                        inTags = true;
                        frontMatter.tags = {};
                        continue;
                    }
                    
                    if (inTags) {
                        if (line.startsWith('  ') && line.includes(':')) {
                            const [key, value] = line.trim().split(':');
                            const arrayMatch = value.trim().match(/^\[(.*)\]$/);
                            if (arrayMatch) {
                                frontMatter.tags[key] = arrayMatch[1]
                                    .split(',')
                                    .map(s => s.trim().replace(/['"]/g, ''))
                                    .filter(s => s);
                            }
                        } else if (!line.startsWith(' ')) {
                            inTags = false;
                        }
                    }
                    
                    if (!inTags && line.includes(':')) {
                        const colonIndex = line.indexOf(':');
                        const key = line.substring(0, colonIndex).trim();
                        const value = line.substring(colonIndex + 1).trim();
                        
                        if (value.startsWith('[') && value.endsWith(']')) {
                            const arrayContent = value.slice(1, -1);
                            frontMatter[key] = arrayContent
                                .split(',')
                                .map(s => s.trim().replace(/['"]/g, ''))
                                .filter(s => s);
                        } else {
                            frontMatter[key] = value.replace(/['"]/g, '');
                        }
                    }
                }
                
                return frontMatter;
            } catch (e) {
                console.error('Error parsing front matter:', e);
                return null;
            }
        }
    </script>
</body>
</html>
